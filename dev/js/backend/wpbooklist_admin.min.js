/**
 * JavaScript Admin Functions - wpbooklist-admin.min.js
 *
 * @author   Jake Evans
 * @category JavaScript
 * @package  Includes/Assets/Js
 * @version  6.0.0
 */

console.log( 'This is the JavaScript Object that holds all PHP Variables for use in JavaScript' );
console.log( wpbooklistPhpVariables );


// All functions wrapped in jQuery( document ).ready()...
jQuery( document ).ready( function( $ ) {
	'use strict';

	/* BEGINNING SECTION TO CALL ALL FUNCTIONS IN FILE... */

	// Enables the 'Apply StylePak' button when first drop-down is changed.
	wpbooklistEnableApplyLibraryStylepakButton();

	// Enables the 'Apply Post Template' button when drop-down is changed.
	wpbooklistEnableApplyPostTemplateButton();

	// Enables the 'Apply Page Template' button when drop-down is changed.
	wpbooklistEnableApplyPageTemplateButton();

	// Enabling the 'Backup Library' button when first drop-down is changed
	wpbooklistEnableBackupLibraryButton();

	// Enabling the 'Restore Library' button when 'select a backup' drop-down is changed
	wpbooklistEnableRestoreLibraryButton();

	// Enabling the 'Create CSV File' button when 'Select a Library' drop-down is changed.
	wpbooklistEnableCreateCsvButton();

	// For switching into bulk delete mode.
	wpbooklistEnableBulkDeleteModeButton();

	// For cancelling bulk delete mode.
	wpbooklistCancelBulkDeleteModeButton();

	// For enabling/disabling the 'Delete Checked Books' button.
	wpbooklistEnableDeleteCheckedBooksButton();

	// For enabling the 'Reorder Books' button.
	wpbooklistEnableReorderModeButton();

	// For turning on 'Reorder Books' mode.
	wpbooklistEnableReorderModeUi();

	// For turning off 'Reorder Books' mode.
	wpbooklistDisableReorderModeUi();

	// Enabling the 'Select a Backup' drop-down when first drop-down is changed
	wpbooklistEnableSelectBackupDropdown();

	// Makes the last active library the viewed library after page reload on the 'Edit & Delete Books' tab
	editLibReload();

	// Highlights the active tab
	wpbooklistHighlightActiveTab();

	// Only allow one localization checkbox to be checked.
	wpbooklistLocalCheckboxControl();

	// Function for enabling the 'Choose Image' button on the 'Add a Book' tab.
	wpbooklistDashboardChooseBookCoverImageButton();

	// Function for Adding a book from the 'Add a Book' tab.
	wpbooklistDashboardAddBook();

	// Function that opens the book up in Colorbox.
	wpbooklistShowBookInColorbox();

	// For clearing the 'Create a New Library' input and disabling/enabling the 'Create New Library' button.
	wpbooklistCreateNewLibraryDisableAndClear();

	// Function to create a new Library from the 'Custom Libraries & Shortcodes' Tab.
	wpbooklistCreateNewLibrary();

	// Function to delete a new Library from the 'Custom Libraries & Shortcodes' Tab.
	wpbooklistDeleteNewLibrary();

	// Function for saving library display options
	wpbooklistSaveLibraryDisplayOptions();

	// Function for saving post display options
	wpbooklistSavePostDisplayOptions();

	// Function for saving page display options
	wpbooklistSavePageDisplayOptions();

	// Function for changing the Library on the Library tab of the Display Options menu.
	wpbooklistChangeLibraryDisplayOptionsLibrary();

	// For toggling the 'Check All' and 'Uncheck All' checkboxes on the 'Library Display Options' page.
	wpbooklistToggleCheckAllLibraryDisplayOptions();

	// Function for showing the Edit Book form.
	wpbooklistEditBookShowForm();

	// Function for switching to the next page of books on the 'Edit & Delete Books' tab.
	wpbooklistEditBookPagination();

	// Function for switching libraries on the Edit Book tab.
	wpbooklistEditBookSwitchLib();

	// Function for searching for a title to edit.
	wpbooklistEditBookSearch();

	// Function that handles the actual editing of a book.
	wpbooklistEditBookActual();

	// For deleting a book.
	wpbooklistDeleteBook();

	// Function for saving user's API info.
	wpbooklistUserApis();

	// For uploading a new StylePak after purchase.
	wpbooklistUploadNewStylepak();

	// For assigning a StylePak to a library.
	wpbooklistAssignStylepak();

	// For uploading a new Post Template after purchase.
	wpbooklistUploadNewPostTemplate();

	// For assigning a Post Template to a Post.
	wpbooklistAssignPostTemplate();

	// For uploading a new Page Template after purchase.
	wpbooklistUploadNewPageTemplate();

	// For assigning a Page Template to a Page.
	wpbooklistAssignPageTemplate();

	// For creating a DB backup of a Library.
	wpbooklistCreateDbLibraryBackup();

	// For restoring a backup of a Library.
	wpbooklistRestoreDbLibraryBackup();

	// For creating a .csv file of ISBN/ASIN numbers.
	wpbooklistCreateCsv();

	// For setting the Amazon Localization.
	wpbooklistAmazonLocalization();

	// For deleting all books in library.
	wpbooklistDeleteAllBooksInLibrary();

	// For deleting all books, pages, and posts in library.
	wpbooklistDeleteAllBooksPagesAndPosts();

	// For deleting all checked books.
	wpbooklistDeleteAllCheckedBooks();

	// For dismissing the admin notice forever.
	wpbooklistDismissPremNoticeForever();

	// For re-ordering books on the 'Edit & Delete Books' tab.
	wpbooklistReorderBooks();

	// For the exit survey triggered when user deactivates WPBookList.
	wpbooklistExitSurveyResults();

	// Handles the popup that appears when the user deactivates WPBookList.
	wpbooklistExitSurvey();

	// For retrieving the WPBookList StoryTime Stories from the server when the 'Select a Category' drop-down changes.
	wpbooklistStorytimeSelectCategory();

	// For retreiving a WPBookList StoryTime Story from the server, once the user has selected one in the reader.
	wpbooklistStorytimeGetStory();

	// For expanding the 'Browse Stories' section again once a Story has already been selected.
	wpbooklistStorytimeExpandBrowse();

	// For saving the StoryTime Settings.
	wpbooklistStorytimeSaveSettings();

	// For deleting a Storytime Story.
	wpbooklistDeleteStorytimeStory();

	// For paging back and forth in a Storytime Story.
	wpbooklistStorytimePageBackForth();

	// For simply linking to Patreon.
	wpbooklistPatreonLink();

	// For validating that a user has become a Patreon Patron for StoryTime.
	wpbooklistPatreonValidate();

	// Enables the Select2 library for selecting multiple libraries to add a book to.
	wpbooklistEnableSelect2();

	// Makes a call to get every single book saved on website to seed the Book form for Autocomplete stuff.
	wpbooklistSeedBookFormAutocomplete();

	// Function for changing the preview image when the URL input is changed on the 'Add a Book' tab.
	wpbooklistDashboardChooseBookCoverImagePreviewChange();

	// Function to display the admin pointer message when entering the Question Mark image with mouse.
	wpbooklistJreAdminPointersJavascript();

	/* ENDING SECTION TO CALL ALL FUNCTIONS IN FILE... */

	// Enables the Select2 library for selecting multiple libraries to add a book to.
	function wpbooklistEnableSelect2() {

		// Activate the Select2 stuff WITH the option of adding in custom dynamic Option
		$( '.select2-input' ).select2({
			tags: true
		});

		// Activate the Select2 stuff WITHOUT the option of adding in custom dynamic Option
		$( '.select2-input-similar-books, .select2-input-libraries, .select2-input-other-editions' ).select2({
			tags: false
		});
	}

	// Enables the 'Apply StylePak' button when first drop-down is changed
	function wpbooklistEnableApplyLibraryStylepakButton() {

		// Enabling the 'Apply StylePak' button when first drop-down is changed.
		$( document ).on( 'change', '#wpbooklist-select-library-stylepak', function( event ) {
			$( '#wpbooklist-addstylepak-success-div' ).html( '' );
			$( '#wpbooklist-apply-library-stylepak' ).prop( 'disabled', false );
		});
	}

	// Enables the 'Apply Post Template' button when drop-down is changed
	function wpbooklistEnableApplyPostTemplateButton() {

		// Enabling the 'Apply Post Template' button when drop-down is changed
		$( document ).on( 'change', '#wpbooklist-select-post-template', function( event ) {
			$( '#wpbooklist-apply-post-template' ).prop( 'disabled', false );
		});
	}

	// Enables the 'Apply Page Template' button when drop-down is changed
	function wpbooklistEnableApplyPageTemplateButton() {

		// Enabling the 'Apply Page Template' button when drop-down is changed
		$( document ).on( 'change', '#wpbooklist-select-page-template', function( event ) {
			$( '#wpbooklist-apply-page-template' ).prop( 'disabled', false );
		});
	}

	// Enabling the 'Backup Library' button when first drop-down is changed
	function wpbooklistEnableBackupLibraryButton() {

		// Enabling the 'Apply Page Template' button when drop-down is changed
		$( document ).on( 'change', '#wpbooklist-backup-select-library', function( event ) {
			$( '#wpbooklist-apply-library-backup' ).prop( 'disabled', false );
		});
	}

	// Enabling the 'Select a Backup' drop-down when first drop-down is changed
	function wpbooklistEnableSelectBackupDropdown() {

		// Enabling the 'Select a Backup' drop-down when first drop-down is changed
		$( document ).on( 'change', '#wpbooklist-select-library-backup', function( event ) {
			var table = $( this ).val();
			$( '#wpbooklist-select-actual-backup' ).val( 'Select a Backup...' );
			$( '#wpbooklist-apply-library-restore' ).prop( 'disabled', true );
			$( '.wpbooklist-backup-actual-option' ).each( function() {
				if ( $( this ).attr( 'data-table' ) != table ) {
					$( this ).css({ 'display': 'none' });
				} else {
					$( this ).css({ 'display': 'block' });
				}
			});
			$( '#wpbooklist-select-actual-backup' ).prop( 'disabled', false );
		});
	}

	// Enabling the 'Restore Library' button when 'select a backup' drop-down is changed
	function wpbooklistEnableRestoreLibraryButton() {

		// Enabling the 'Restore Library' button when 'select a backup' drop-down is changed
		$( document ).on( 'change', '#wpbooklist-select-actual-backup', function( event ) {
			$( '#wpbooklist-apply-library-restore' ).prop( 'disabled', false );
		});
	}

	// Enabling the 'Create CSV File' button when 'Select a Library' drop-down is changed.
	function wpbooklistEnableCreateCsvButton() {

		// Enabling the 'Create CSV File' button when 'Select a Library' drop-down is changed
		$( document ).on( 'change', '#wpbooklist-backup-csv-select-library', function( event ) {
			$( '#wpbooklist-apply-library-backup-csv' ).prop( 'disabled', false );
		});
	}

	// For switching into bulk delete mode
	function wpbooklistEnableBulkDeleteModeButton() {

		// For switching into bulk delete mode
		$( document ).on( 'click', '#wpbooklist-bulk-edit-mode-on-button', function( event ) {
			$( '#wpbooklist-reorder-button' ).css({ 'pointer-events': 'none', 'opacity': '0.7' });
			$( '#wpbooklist-bulk-edit-div' ).animate({ 'height': '185px' });
			$( '.wpbooklist-edit-actions-edit-button' ).css({ 'opacity': '0.2', 'pointer-events': 'none' });
			$( '.wpbooklist-edit-actions-delete-button' ).css({ 'opacity': '0.2', 'pointer-events': 'none' });
			$( '.wpbooklist-edit-img-author-div' ).css({ 'opacity': '0.2', 'pointer-events': 'none' });
			$( '.wpbooklist-bulk-delete-checkbox-div' ).css({ 'display': 'block' });
		});
	}

	// For cancelling bulk delete mode.
	function wpbooklistCancelBulkDeleteModeButton() {

		// For cancelling bulk delete mode
		$( document ).on( 'click', '#wpbooklist-bulk-edit-mode-delete-all-in-lib-cancel', function( event ) {
			$( '#wpbooklist-reorder-button' ).css({ 'pointer-events': 'all', 'opacity': '1' });
			$( '#wpbooklist-bulk-edit-div' ).animate({ 'height': '60px' });
			$( '.wpbooklist-edit-actions-div' ).animate({ 'opacity': '1' });
			$( '.wpbooklist-edit-actions-edit-button' ).css({ 'opacity': '1', 'pointer-events': 'all' });
			$( '.wpbooklist-edit-actions-delete-button' ).css({ 'opacity': '1', 'pointer-events': 'all' });
			$( '.wpbooklist-edit-img-author-div' ).css({ 'opacity': '1', 'pointer-events': 'all' });
			$( '.wpbooklist-bulk-delete-checkbox-div' ).css({ 'display': 'none' });
			$( '#wpbooklist-reorder-button' ).prop( 'disabled', false );
		});
	}

	// For enabling/disabling the 'Delete Checked Books' button
	function wpbooklistEnableDeleteCheckedBooksButton() {

		// For enabling/disabling the 'Delete Checked Books' button
		$( document ).on( 'change', '.wpbooklist-bulk-delete-checkbox', function( event ) {
			$( '#wpbooklist-bulk-edit-mode-delete-checked' ).attr( 'disabled', true );
			$( '.wpbooklist-bulk-delete-checkbox' ).each( function() {
				if ( true === $( this ).prop( 'checked' ) ) {
					$( '#wpbooklist-bulk-edit-mode-delete-checked' ).removeAttr( 'disabled' );
				}
			});
		});
	}

	// For enabling the 'Reorder Books' button.
	function wpbooklistEnableReorderModeButton() {

		// Enable the reorder button again immediately upon clicking 'Cancel'
		$( document ).on( 'mousedown', '#wpbooklist-cancel-reorder-button', function() {
			$( '#wpbooklist-reorder-button' ).prop( 'disabled', false );
		});
	}

	// For turning on 'Reorder Books' mode.
	function wpbooklistEnableReorderModeUi() {

		// Disable the edit & Delete buttons, change UI to reflect 'reorder mode'.
		$( document ).on( 'click', '#wpbooklist-reorder-button', function() {
			$( '.wpbooklist-edit-actions-edit-button, .wpbooklist-edit-actions-delete-button, .wpbooklist-edit-book-title, .wpbooklist-edit-book-cover-img' ).css({ 'pointer-events': 'none' });
			$( '#wpbooklist-reorder-button' ).prop( 'disabled', true );
			$( '#wpbooklist-bulk-edit-mode-on-button' ).animate({ 'top': '60px' });
			$( '#wpbooklist-cancel-reorder-button' ).animate({ 'opacity': '1' });
			$( '#wpbooklist-cancel-reorder-button' ).css({ 'z-index': '1' });
			$( '.wpbooklist-edit-actions-div' ).css({ 'opacity': '0.3' });
			$( '.wpbooklist-show-book-colorbox' ).css({ 'cursor': 'move' });
			$( '.wpbooklist-edit-book-icon' ).css({ 'cursor': 'move' });
			$( '.wpbooklist-search-indiv-container' ).css({ 'cursor': 'move' });

			$( '.wpbooklist-search-indiv-container' ).each( function() {
				$( this ).addClass( 'wpbooklist-search-indiv-container-reorder' );
			});
		});
	}

	// For turning off 'Reorder Books' mode.
	function wpbooklistDisableReorderModeUi() {

		// Undo UI changes from 'reorder mode'.
		$( document ).on( 'click', '#wpbooklist-cancel-reorder-button', function() {
			$( '.wpbooklist-edit-actions-edit-button, .wpbooklist-edit-actions-delete-button, .wpbooklist-edit-book-title, .wpbooklist-edit-book-cover-img' ).css({ 'pointer-events': 'all' });
			$( '#wpbooklist-bulk-edit-mode-on-button' ).animate({ 'top': '31px' });
			$( '#wpbooklist-cancel-reorder-button' ).animate({ 'opacity': '0' });
			$( '#wpbooklist-cancel-reorder-button' ).css({ 'z-index': '-9' });
			$( '.wpbooklist-edit-actions-div' ).css({ 'opacity': '1' });
			$( '.wpbooklist-show-book-colorbox' ).css({ 'cursor': 'pointer' });
			$( '.wpbooklist-edit-book-icon' ).css({ 'cursor': 'auto' });
			$( '.wpbooklist-search-indiv-container' ).css({ 'cursor': 'auto' });

			$( '.wpbooklist-search-indiv-container' ).each( function() {
				$( this ).removeClass( 'wpbooklist-search-indiv-container-reorder' );
			});
		});
	}

	// Making the last active library the viewed library after page reload on the 'Edit & Delete Books' tab
	function editLibReload() {

		// Making the last active library the viewed library after page reload.
		if ( window.location.href.includes( 'library=' ) && window.location.href.includes( 'tab=edit-books' ) && window.location.href.includes( 'WPBookList' ) ) {
			$( '#wpbooklist-editbook-select-library' ).val( window.location.href.substr( window.location.href.lastIndexOf( '=' ) + 1 ) );
			$( '#wpbooklist-editbook-select-library' ).trigger( 'change' );
		}
	}

	function wpbooklistHighlightActiveTab() {

		// Highlight active tab
		if ( window.location.href.includes( '&tab=' ) ) {
			$( '.nav-tab' ).each( function() {
				if ( window.location.href == wpbooklistPhpVariables.FOR_TAB_HIGHLIGHT + $( this ).attr( 'href' ) ) {
					$( this ).first().css({ 'background-color': '#F05A1A', 'color': 'white' });
				}
			});
		} else {
			$( '.nav-tab' ).first().css({ 'background-color': '#F05A1A', 'color': 'white' });
		}
	}

	// Only allow one localization checkbox to be checked.
	function wpbooklistLocalCheckboxControl() {

		// Only allow one localization checkbox to be checked.
		$( '.wpbooklist-localization-checkbox' ).change( function() {
			$( '[name=us-based-book-info]' ).attr( 'checked', false );
			$( '[name=uk-based-book-info]' ).attr( 'checked', false );
			$( '[name=au-based-book-info]' ).attr( 'checked', false );
			$( '[name=br-based-book-info]' ).attr( 'checked', false );
			$( '[name=ca-based-book-info]' ).attr( 'checked', false );
			$( '[name=cn-based-book-info]' ).attr( 'checked', false );
			$( '[name=fr-based-book-info]' ).attr( 'checked', false );
			$( '[name=de-based-book-info]' ).attr( 'checked', false );
			$( '[name=in-based-book-info]' ).attr( 'checked', false );
			$( '[name=it-based-book-info]' ).attr( 'checked', false );
			$( '[name=jp-based-book-info]' ).attr( 'checked', false );
			$( '[name=mx-based-book-info]' ).attr( 'checked', false );
			$( '[name=es-based-book-info]' ).attr( 'checked', false );
			$( '[name=nl-based-book-info]' ).attr( 'checked', false );
			$( '[name=sg-based-book-info]' ).attr( 'checked', false );
			$( this ).attr( 'checked', true );
		});
	}

	// Function for enabling the 'Choose Image' button on the 'Add a Book' tab.
	function wpbooklistDashboardChooseBookCoverImageButton() {

		// For the book cover image upload
		var fileFrame;
		var wpMediaPostId = 0;
		var setToPostId = 0;
		if ( undefined !== wp && undefined !== wp.media ) {
			wpMediaPostId = wp.media.model.settings.post.id; // Store the old id
			setToPostId = wpbooklistPhpVariables.SAVED_ATTACHEMENT_ID; // Set this

			$( document ).on( 'click', '.wpbooklist-addbook-upload_image_button, #wpbooklist-storefront-img-button-1, #wpbooklist-storefront-img-button-2, #wpbooklist-branding-img-button-1, #wpbooklist-branding-img-button-2, #wpbooklist-editbook-upload_image_button', function( event ) {

				var buttonid = $( this ).attr( 'id' );
				$( this ).attr( 'data-active', true );
				event.preventDefault();

				// If the media frame already exists, reopen it.
				if ( fileFrame ) {

					// Set the post ID to what we want
					fileFrame.uploader.uploader.param( 'post_id', setToPostId );

					// Open frame
					fileFrame.open();
					return;
				} else {

					// Set the wp.media post id so the uploader grabs the ID we want when initialised
					wp.media.model.settings.post.id = setToPostId;
				}

				// Create the media frame.
				fileFrame = wp.media.frames.fileFrame = wp.media({
					title: 'Select a image to upload',
					button: {
						text: 'Use this image'
					},
					multiple: false
				});

				// When an image is selected, run a callback.
				fileFrame.on( 'select', function() {

					// We set multiple to false so only get one image from the uploader
					var attachment = fileFrame.state().get( 'selection' ).first().toJSON();
					var previewID = '';
					var urlInputID = '';

					// Do something with attachment.id and/or attachment.url here
					$( '#wpbooklist-editbook-image' ).val( attachment.url );
					$( '#wpbooklist-editbook-preview-img' ).attr( 'src', attachment.url );

					// Add preview images to dom
					$( '.wpbooklist-addbook-upload_image_button' ).each( function() {
						if ( 'true' === $( this ).attr( 'data-active' ) ) {
							previewID = $( this ).attr( 'data-previewid' );
							urlInputID = $( this ).attr( 'data-urlinputid' );
							$( '#' + urlInputID ).val( attachment.url );
							$( '#' + previewID ).attr( 'src', attachment.url );
							$( this ).attr( 'data-active', false );
						}
					});

					// Add preview image to dom for branding extension
					if ( 'true' === $( '#wpbooklist-branding-img-button-1' ).attr( 'data-active' ) ) {
						$( '#wpbooklist-branding-image-url-1' ).val( attachment.url );
						$( '#wpbooklist-branding-preview-img-1' ).attr( 'src', attachment.url );
						$( '#wpbooklist-branding-img-button-1' ).attr( 'data-active', false );
					}

					// Add second preview image to dom for branding extension
					if ( 'true' === $( '#wpbooklist-branding-img-button-2' ).attr( 'data-active' ) ) {
						$( '#wpbooklist-branding-image-url-2' ).val( attachment.url );
						$( '#wpbooklist-branding-preview-img-2' ).attr( 'src', attachment.url );
						$( '#wpbooklist-branding-img-button-2' ).attr( 'data-active', false );
					}


					// Add preview image to dom for storefront extension
					if ( 'true' === $( '#wpbooklist-storefront-img-button-1' ).attr( 'data-active' ) ) {
						$( '#wpbooklist-branding-image-url-2' ).val( attachment.url );
						$( '#wpbooklist-storefront-preview-img-1' ).attr( 'src', attachment.url );
						$( '#wpbooklist-storefront-img-button-1' ).attr( 'data-active', false );
					}

					// Add second preview image to dom for storefront extension
					if ( 'true' === $( '#wpbooklist-storefront-img-button-2' ).attr( 'data-active' ) ) {
						$( '#wpbooklist-storefront-preview-img-2' ).attr( 'src', attachment.url );
						$( '#wpbooklist-storefront-img-button-2' ).attr( 'data-active', false );
					}

					// Restore the main post ID
					wp.media.model.settings.post.id = wpMediaPostId;
				});

				// Finally, open the modal
				fileFrame.open();
			});

			// Restore the main ID when the add media button is pressed
			jQuery( 'a.add_media' ).on( 'click', function() {
				wp.media.model.settings.post.id = wpMediaPostId;
			});
		}

	}

	// Function for changing the preview image when the URL input is changed on the 'Add a Book' tab.
	function wpbooklistDashboardChooseBookCoverImagePreviewChange() {
		$( document ).on( 'change', '.wpbooklist-addbook-image-url-input', function( event ) {

			var previewId = '';

			if ( -1 < $( this ).val().indexOf( '.jpg' ) ||  -1 < $( this ).val().indexOf( '.jpeg' ) || -1 < $( this ).val().indexOf( '.png' ) || -1 < $( this ).val().indexOf( '.svg' ) || -1 < $( this ).val().indexOf( '.gif' ) || -1 < $( this ).val().indexOf( '.tiff' ) || -1 < $( this ).val().indexOf( '.webp' ) ) {
				previewId = $( this ).attr( 'data-previewid' );

				$( '#' + previewId ).attr( 'src', $( this ).val() );
			}
		});
	}

	// Function for Adding a book from the 'Add a Book' tab.
	function wpbooklistDashboardAddBook() {

		// When the Add A Book form submits
		$( '#wpbooklist-admin-addbook-button' ).click( function( event ) {

			var successDiv = $( '#wpbooklist-addbook-success-div' );
			var error = false;
			var woocommerce = false;
			var woofile = '';
			var amazonAuthYes = $( 'input[name="authorize-amazon-yes"]' ).prop( 'checked' );
			var library = $( '#wpbooklist-addbook-select-library' ).val();
			var useAmazonYes = $( 'input[name="use-amazon-yes"]' ).prop( 'checked' );
			var isbn = $( 'input[name="book-isbn10"]' ).val();
			var isbn13 = $( 'input[name="book-isbn13"]' ).val();
			var asin = $( 'input[name="book-asin"]' ).val();
			var title = $( 'input[name="book-title"]' ).val();
			var originaltitle = $( 'input[name="book-originaltitle"]' ).val();
			var author = $( 'input[name="book-author1"]' ).val();
			var author2 = $( 'input[name="book-author2"]' ).val();
			var author3 = $( 'input[name="book-author3"]' ).val();
			var authorUrl = $( 'input[name="book-sale-author-link"]' ).val();
			var category = $( 'input[name="book-genre"]' ).val();
			var price = $( 'input[name="book-price"]' ).val();
			var pages = $( 'input[name="book-pages"]' ).val();
			var pubYear = $( 'input[name="book-publicationyear"]' ).val();
			var originalpubYear = $( 'input[name="book-originalpublicationyear"]' ).val();
			var publisher = $( 'input[name="book-publisher"]' ).val();
			var description = $( 'textarea[name="book-description"]' ).val();
			var subject = $( 'input[name="book-subject"]' ).val();
			var country = $( 'input[name="book-country"]' ).val();
			var notes = $( 'textarea[name="book-notes"]' ).val();
			var rating = $( '#wpbooklist-addbook-rating' ).val();
			var image = $( 'input[name="book-image"]' ).val();
			var finished = $( 'input[name="book-finished-yes"]' ).prop( 'checked' );
			var dateFinished = $( 'input[name="book-date-finished-text"]' ).val();
			var signed = $( 'input[name="book-signed-yes"]' ).prop( 'checked' );
			var firstEdition = $( 'input[name="book-firstedition-yes"]' ).prop( 'checked' );
			var pageYes = $( 'input[name="book-indiv-page-yes"]' ).prop( 'checked' );
			var postYes = $( 'input[name="book-indiv-post-yes"]' ).prop( 'checked' );
			var swapYes = $( 'input[name="book-bookswapper-yes"]' ).prop( 'checked' );
			var copies = $( 'input[name="book-lend-copies"]' ).val();
			var woocommerce = $( 'input[name="book-woocommerce-yes"]' ).prop( 'checked' );
			var salePrice = $( 'input[name="book-woo-sale-price"]' ).val();
			var regularPrice = $( 'input[name="book-woo-regular-price"]' ).val();
			var stock = $( 'input[name="book-woo-stock"]' ).val();
			var length = $( 'input[name="book-woo-length"]' ).val();
			var width = $( 'input[name="book-woo-width"]' ).val();
			var height = $( 'input[name="book-woo-height"]' ).val();
			var weight = $( 'input[name="book-woo-weight"]' ).val();
			var sku = $( '#wpbooklist-addbook-woo-sku' ).val();
			var virtual = $( 'input[name="wpbooklist-woocommerce-vert-yes"]' ).prop( 'checked' );
			var download = $( 'input[name="wpbooklist-woocommerce-download-yes"]' ).prop( 'checked' );
			var woofile = $( '#wpbooklist-storefront-preview-img-1' ).attr( 'data-id' );
			var salebegin = $( '#wpbooklist-addbook-woo-salebegin' ).val();
			var saleend = $( '#wpbooklist-addbook-woo-saleend' ).val();
			var purchasenote = $( '#wpbooklist-addbook-woo-note' ).val();
			var productcategory = $( '#wpbooklist-woocommerce-category-select' ).val();
			var reviews = $( '#wpbooklist-woocommerce-review-yes' ).prop( 'checked' );
			var upsells = $( '#select2-upsells' ).val();
			var crosssells = $( '#select2-crosssells' ).val();
			var upsellString = '';
			var crosssellString = '';
			var finishedtemp = '';
			var data = [];
			var request = '';
			var apicallreport = '';
			var whichapifound = '';
			var amazonapifailcount = '';
			var amazontransient = '';
			var googletransient = '';
			var openlibrarytransient = '';
			var itunestransient = '';
			var itunesaudiotransient = '';
			var addBookSuccess1 = '';
			var shortcode = '';
			var addBookSuccess2 = '';
			var addBookSuccess3 = '';
			var endMessage = '';

			$( '#wpbooklist-addbook-signed-first-table' ).animate({ 'margin-bottom': '40px'}, 500 );
			$( '#wpbooklist-success-view-post' ).animate({ 'opacity': '0'}, 500 );
			successDiv.html( '' );
			wpbooklist_add_book_validator();
			error = $( '#wpbooklist-add-book-error-check' ).attr( 'data-add-book-form-error' );

			// Making checks to see if Storefront extension is active
			if ( upsells != undefined ) {
				for ( var i = 0; i < upsells.length; i++ ) {
					upsellString = upsellString + ', ' + upsells[i];
				};
			}

			if ( crosssells != undefined ) {
				for ( var i = 0; i < crosssells.length; i++ ) {
					crosssellString = crosssellString + ', ' + crosssells[i];
				};
			}

			if ( salebegin != undefined && saleend != undefined ) {

				// Flipping the sale date start
				if ( salebegin.indexOf( '-' ) ) {
					finishedtemp = salebegin.split( '-' );
					salebegin = finishedtemp[0] + '-' + finishedtemp[1] + '-' + finishedtemp[2];
				}

				// Flipping the sale date end
				if ( saleend.indexOf( '-' ) ) {
					finishedtemp = saleend.split( '-' );
					saleend = finishedtemp[0] + '-' + finishedtemp[1] + '-' + finishedtemp[2];
				}
			}


			// Flipping the date
			if ( dateFinished.indexOf( '-' ) ) {
				finishedtemp = dateFinished.split( '-' );
				dateFinished = finishedtemp[1] + '-' + finishedtemp[2] + '-' + finishedtemp[0];
			}

			if ( 'false' === error ) {

				// Show working spinner
				$( '#wpbooklist-spinner-1' ).animate({ 'opacity': '1'}, 500 );

				data = {
					'action': 'wpbooklist_dashboard_add_book_action',
					'security': wpbooklistPhpVariables.adminnonce2,
					'amazonAuthYes': amazonAuthYes,
					'library': library,
					'useAmazonYes': useAmazonYes,
					'isbn': isbn,
					'title': title,
					'author': author,
					'authorUrl': authorUrl,
					'category': category,
					'price': price,
					'pages': pages,
					'pubYear': pubYear,
					'publisher': publisher,
					'description': description,
					'subject': subject,
					'country': country,
					'notes': notes,
					'rating': rating,
					'image': image,
					'finished': finished,
					'dateFinished': dateFinished,
					'signed': signed,
					'firstEdition': firstEdition,
					'pageYes': pageYes,
					'postYes': postYes,
					'swapYes': swapYes,
					'copies': copies,
					'woocommerce': woocommerce,
					'saleprice': salePrice,
					'regularprice': regularPrice,
					'stock': stock,
					'length': length,
					'width': width,
					'height': height,
					'weight': weight,
					'sku': sku,
					'virtual': virtual,
					'download': download,
					'woofile': woofile,
					'salebegin': salebegin,
					'saleend': saleend,
					'purchasenote': purchasenote,
					'productcategory': productcategory,
					'reviews': reviews,
					'upsells': upsellString,
					'crosssells': crosssellString
				};
				console.log( 'Here\'s the data that is being sent to the server to add a book: ' );
				console.log( data );

				request = $.ajax({
					url: ajaxurl,
					type: 'POST',
					data: data,
					timeout: 0,
					success: function( response ) {

						// Split up the reponse, set up some variables based on reposne, display messages to user
						response = response.split( '--sep--' );
						console.log( response );
						if ( '1' === response[0]) {

							apicallreport = response[7];
							whichapifound = JSON.parse( response[8]);
							amazonapifailcount = response[9];
							amazontransient = response[10];
							googletransient = response[11];
							openlibrarytransient = response[12];
							itunestransient = response[13];
							itunesaudiotransient = response[14];

							console.log( apicallreport );
							console.log( 'Here\'s the report for where this book\'s data was obtained from: ' );
							console.log( whichapifound );
							console.log( 'The Amazon Fail Count was: ' + amazonapifailcount );
							console.log( 'Did we use an Amazon Transient? ' + amazontransient );
							console.log( 'Did we use a Google Transient? ' + googletransient );
							console.log( 'Did we use an OpenLibrary Transient? ' + openlibrarytransient );
							console.log( 'Did we use an iTunesLibrary Transient? ' + itunestransient );
							console.log( 'Did we use an iTunes Audio Transient? ' + itunesaudiotransient );


							if ( useAmazonYes ) {
								if ( 2 === amazonapifailcount || '2' === amazonapifailcount ) {
									addBookSuccess1 = '<p><span id="wpbooklist-add-book-success-span">' + wpbooklistPhpVariables.trans49 + '</span><br/> ' + wpbooklistPhpVariables.trans50 + '<em> ' + wpbooklistPhpVariables.trans51 + ' </em>' + wpbooklistPhpVariables.trans52;
								} else {
									addBookSuccess1 = '<p><span id="wpbooklist-add-book-success-span">' + wpbooklistPhpVariables.trans38 + '</span><br/> ' + wpbooklistPhpVariables.trans39 + ' <span id="wpbooklist-addbook-success-shortcode">';
								}
							} else {
								addBookSuccess1 = '<p><span id="wpbooklist-add-book-success-span">' + wpbooklistPhpVariables.trans38 + '</span><br/> ' + wpbooklistPhpVariables.trans39 + ' <span id="wpbooklist-addbook-success-shortcode">';
							}

							if ( library.includes( 'wpbooklist_jre_saved_book_log' ) ) {
								shortcode = '[wpbooklist_shortcode]';
							} else {
								library = library.split( '_' );
								library = library[library.length - 1];
								shortcode = '[wpbooklist_shortcode table="' + library + '"]';
							}

							if ( useAmazonYes ) {
								if ( 2 === amazonapifailcount || '2' === amazonapifailcount ) {
									addBookSuccess2 = '</span></p><a id="wpbooklist-success-1" class="wpbooklist-show-book-colorbox">' + wpbooklistPhpVariables.trans40 + '</a>';
								} else {
									addBookSuccess2 = shortcode + '</span></p><a id="wpbooklist-success-1" class="wpbooklist-show-book-colorbox">' + wpbooklistPhpVariables.trans40 + '</a>';
								}
							} else {
								addBookSuccess2 = shortcode + '</span></p><a id="wpbooklist-success-1" class="wpbooklist-show-book-colorbox">' + wpbooklistPhpVariables.trans40 + '</a>';
							}

							// If book addition was succesful and user chose to create a post
							if ( 'true' === response[4] && 'false' === response[3]) {
								addBookSuccess3 = '<p id="wpbooklist-addbook-success-post-p"><a href="' + response[6] + '">' + wpbooklistPhpVariables.trans41 + '</a></p></div>';
								$( '#wpbooklist-addbook-signed-first-table' ).animate({ 'margin-bottom': '70px'}, 500 );
								$( '#wpbooklist-success-view-post' ).animate({ 'opacity': '1'}, 500 );
							}

							// If book addition was succesful and user chose to create a page
							if ( 'true' === response[3] && 'false' === response[4]) {
								addBookSuccess3 = '<p id="wpbooklist-addbook-success-page-p"><a href="' + response[5] + '">' + wpbooklistPhpVariables.trans42 + '</a></p></div>';
								$( '#wpbooklist-addbook-signed-first-table' ).animate({ 'margin-bottom': '70px'}, 500 );
								$( '#wpbooklist-success-view-page' ).animate({ 'opacity': '1'}, 500 );
							}

							// If book addition was succesful and user chose to create a post and a page
							if ( 'true' === response[3] && 'true' === response[4]) {
								addBookSuccess3 = '<p id="wpbooklist-addbook-success-page-p"><a href="' + response[5] + '">' + wpbooklistPhpVariables.trans42 + '</a></p><p id="wpbooklist-addbook-success-post-p"><a href="' + response[6] + '">' + wpbooklistPhpVariables.trans41 + '</a></p></div>';
								$( '#wpbooklist-addbook-signed-first-table' ).animate({ 'margin-bottom': '100px'}, 500 );
								$( '#wpbooklist-success-view-page' ).animate({ 'opacity': '1'}, 500 );
								$( '#wpbooklist-success-view-post' ).animate({ 'opacity': '1'}, 500 );
							}

							// Add response message to DOM
							endMessage = '<div id="wpbooklist-addbook-success-thanks">' + wpbooklistPhpVariables.trans43 + '<a href="http://wpbooklist.com/index.php/extensions/">&nbsp;' + wpbooklistPhpVariables.trans44 + '</a><br/><br/>' + wpbooklistPhpVariables.trans45 + ' <a id="wpbooklist-addbook-success-review-link" href="https://wordpress.org/support/plugin/wpbooklist/reviews/?filter=5" >' + wpbooklistPhpVariables.trans46 + '</a><img id="wpbooklist-smile-icon-1" src="' + wpbooklistPhpVariables.ROOT_IMG_ICONS_URL + 'happy.svg"></div>';
							successDiv.html( addBookSuccess1 + addBookSuccess2 + addBookSuccess3 + endMessage );

							$( '#wpbooklist-spinner-1' ).animate({ 'opacity': '0'}, 500 );
							$( '#wpbooklist-success-1' ).animate({ 'opacity': '1'}, 500 );
							$( '#wpbooklist-success-1' ).attr( 'data-bookid', response[1]);
							$( '#wpbooklist-success-1' ).attr( 'data-booktable', response[2]);
						} else {
							$( '#wpbooklist-addbook-signed-first-table' ).animate({ 'margin-bottom': '65px'}, 500 );
							successDiv.html( wpbooklistPhpVariables.trans47 + ' <a href="mailto: techsupport@wpbooklist.com">' + wpbooklistPhpVariables.trans48 + '</a><br/><br/>' + response[1]);
							$( '#wpbooklist-spinner-1' ).animate({ 'opacity': '0'}, 500 );
							$( '#wpbooklist-success-1' ).animate({ 'opacity': '1'}, 500 );
						}
					},
					error: function( jqXHR, textStatus, errorThrown ) {
						$( '#wpbooklist-success-1' ).html( wpbooklistPhpVariables.trans47 );
						$( '#wpbooklist-spinner-1' ).animate({ 'opacity': '0'}, 500 );
						$( '#wpbooklist-success-1' ).animate({ 'opacity': '1'}, 500 );
						console.log( errorThrown );
						console.log( textStatus );
						console.log( jqXHR );
					}
				});
			}

			event.preventDefault ? event.preventDefault() : event.returnValue = false;

		});

	}


	// Function that opens the book up in Colorbox.
	function wpbooklistShowBookInColorbox() {
		$( document ).on( 'click', '.wpbooklist-show-book-colorbox', function( event ) {

			var bookId = $( this ).attr( 'data-bookid' );
			var bookTable = $( this ).attr( 'data-booktable' );
			var brandingtext1 = '';
			var brandingtext2 = '';
			var brandinglogo1 = '';
			var brandinglogo2 = '';
			var sortParam = '';
			var url = '';
			var data = [];
			var request = '';

			brandingtext1 = $( '#wpbooklist-branding-text-1' ).attr( 'data-value' );
			if ( undefined === brandingtext1 ) {
				brandingtext1 = '';
			}
			brandingtext2 = $( '#wpbooklist-branding-text-2' ).attr( 'data-value' );
			if ( undefined === brandingtext2 ) {
				brandingtext2 = '';
			}

			brandinglogo1 = $( '#wpbooklist-branding-logo-1' ).attr( 'data-value' );
			if ( undefined === brandinglogo1 ) {
				brandinglogo1 = '';
			}

			brandinglogo2 = $( '#wpbooklist-branding-logo-2' ).attr( 'data-value' );
			if ( undefined === brandinglogo2 ) {
				brandinglogo2 = '';
			}

			// The variable to tell colorbox whether this string exists in the url: sortby=alphabeticallybyauthorlast, and if so, to swap around the Author names.
			url = window.location.href;
			if ( -1 < url.indexOf( 'sortby=alphabeticallybyauthorlast' ) ) {
				sortParam = 'true';
			}

			data = {
				'action': 'wpbooklist_show_book_in_colorbox_action',
				'security': wpbooklistPhpVariables.adminnonce3,
				'bookId': bookId,
				'bookTable': bookTable,
				'sortParam': sortParam
			};
			console.log( data );

			$.colorbox({
				iframe: true,
				title: wpbooklistPhpVariables.trans55,
				width: '50%',
				height: '80%',
				html: '&nbsp;',
				fastIframe: false,
				onComplete: function() {
					if ( '' !== brandinglogo1 ) {
						$( '#wpbooklist-branding-img-1-id' ).remove();
						$( '#cboxLoadingGraphic' ).css({ 'background': 'none' });
						$( '#cboxLoadingGraphic' ).append( '<img style="margin-left: auto;margin-right: auto;display: block;width: 20%;margin-top: 15%;" id="wpbooklist-branding-img-1-id" src="' + brandinglogo1 + '" />' );
					}

					if ( '' !== brandingtext1 ) {
						$( '#wpbooklist-branding-text-1-id' ).remove();
						$( '#cboxLoadingGraphic' ).css({ 'background': 'none' });
						$( '#cboxLoadingGraphic' ).append( '<p style="text-align: center;font-style: italic;font-size: 17px;font-weight: bold;" id="wpbooklist-branding-text-1-id">' + brandingtext1 + '</p>' );
					}

					$( '#cboxLoadingGraphic' ).show();
					$( '#cboxLoadingGraphic' ).css({ 'display': 'block' });
				}
			});

			request = $.ajax({
				url: ajaxurl,
				type: 'POST',
				data: data,
				timeout: 0,
				success: function( response ) {

					response = response.split( '---sep---' );
					console.log( response[1]);

					$.colorbox({
						open: true,
						preloading: true,
						scrolling: true,
						width: '70%',
						height: '70%',
						html: response[0],
						onClosed: function() {

						},
						onComplete: function() {

							var viewerDiv = document.getElementById( 'google-preview-div' );
							var test = '';

							if ( '' !== brandinglogo2 && '' === brandingtext2 ) {
								$( '#cboxTitle' ).css({ 'border': 'solid 1px #e1e1e1', 'height': '100px', 'background-color': 'white', 'bottom': '-95px' });
								$( '#cboxWrapper' ).css({ 'overflow': 'visible' });
								$( '#colorbox' ).css({ 'height': ( $( '#colorbox' ).height() + 100 ) + 'px' });
								$( '#cboxTitle' ).append( '<img id="wpbooklist-branding-logo-2-id" style="width:50px; margin-top:20px;" src="' + brandinglogo2 + '" />' );
							}

							if ( '' !== brandingtext2 && '' === brandinglogo2 ) {
								$( '#cboxTitle' ).css({ 'border': 'solid 1px #e1e1e1', 'height': '100px', 'background-color': 'white', 'bottom': '-95px' });
								$( '#cboxWrapper' ).css({ 'overflow': 'visible' });
								$( '#colorbox' ).css({ 'height': ( $( '#colorbox' ).height() + 100 ) + 'px' });
								$( '#cboxTitle' ).append( '<p style="text-align: center;font-style: italic;font-size: 17px;font-weight: bold;" id="wpbooklist-branding-text-2-id">' + brandingtext2 + '</p>' );
							}

							if ( '' !== brandingtext2 && '' !== brandinglogo2 ) {
								$( '#cboxTitle' ).css({ 'border': 'solid 1px #e1e1e1', 'height': '100px', 'background-color': 'white', 'bottom': '-95px' });
								$( '#cboxWrapper' ).css({ 'overflow': 'visible' });
								$( '#colorbox' ).css({ 'height': ( $( '#colorbox' ).height() + 100 ) + 'px' });
								$( '#cboxTitle' ).append( '<img id="wpbooklist-branding-logo-2-id" style="display: inline-block; margin-right:10px; margin-top:20px; width:50px;" src="' + brandinglogo2 + '" /><p style="display: inline-block; text-align: center; margin: 0; bottom: 20px; position: relative; font-style: italic;font-size: 17px;font-weight: bold;" id="wpbooklist-branding-text-2-id">' + brandingtext2 + '</p>' );
							}

							// Hide blank 'Similar Titles' images
							$( '.wpbooklist-similar-image' ).load( function() {
								var image = new Image();
								image.src = $( this ).attr( 'src' );
								if ( '1' === image.naturalHeight ) {
									$( this ).parent().parent().css({ 'display': 'none' });
								}
							});

							// For the Google Preview in the Google Preview Extension
							function alertInitialized() {

								$( '#google-preview-no-results-div' ).css({ 'display': 'none' });
								$( '#wpbooklist-google-title-id' ).css({ 'display': 'block' });
								$( '.wpbooklist_google_p_class' ).css({ 'display': 'block' });
							}

							// For the Google Preview in the Google Preview Extension
							if ( 0 < $( '#google-preview-div' ).length ) {

								$( '.wpbooklist_google_p_class' ).css({ 'display': 'none' });
								bookViewer = new google.books.DefaultViewer( viewerDiv );
								test = bookViewer.load( response[1], null, alertInitialized );
							}


							addthis.toolbox(
								$( '.addthis_sharing_toolbox' ).get()
							);
							addthis.toolbox(
								$( '.addthis_sharing_toolbox' ).get()
							);
							addthis.counter(
								$( '.addthis_counter' ).get()
							);
						}
					});


				},
				error: function( jqXHR, textStatus, errorThrown ) {
					console.log( errorThrown );
					console.log( textStatus );
					console.log( jqXHR );
				}
			});
		});
	}

	// For clearing the 'Create a New Library' input and disabling/enabling the 'Create New Library' button.
	function wpbooklistCreateNewLibraryDisableAndClear() {

		// Handles the enabling/disabling of the 'Create a Library' button and input placeholder text
		$( '.wpbooklist-dynamic-input' ).on( 'click', function() {
			var currentVal = $( '.wpbooklist-dynamic-input' ).val();
			console.log( currentVal );
			console.log( wpbooklistPhpVariables.trans54 );
			if ( currentVal == wpbooklistPhpVariables.trans54 + '...' ) {
				$( '.wpbooklist-dynamic-input' ).val( '' );
			}
		});
		$( '.wpbooklist-dynamic-input' ).bind( 'input', function() {
			var currentVal = $( '.wpbooklist-dynamic-input' ).val();
			if ( ( 0 < currentVal.length ) && ( currentVal != wpbooklistPhpVariables.trans54 + '...' ) ) {
				$( '#wpbooklist-dynamic-shortcode-button' ).attr( 'disabled', false );
			}
		});
	}

	// For toggling the 'Check All' and 'Uncheck All' checkboxes on the 'Library Display Options' page.
	function wpbooklistToggleCheckAllLibraryDisplayOptions() {

		// Handles the 'check all' and 'uncheck all' function of the display options
		$( '#wpbooklist-check-all' ).on( 'click', function() {
			$( '#wpbooklist-uncheck-all' ).prop( 'checked', false );
			$( '#wpbooklist-jre-backend-options-table input' ).each( function() {
				$( this ).prop( 'checked', true );
			});
		});
		$( '#wpbooklist-uncheck-all' ).on( 'click', function() {
			$( '#wpbooklist-check-all' ).prop( 'checked', false );
			$( '#wpbooklist-jre-backend-options-table input' ).each( function() {
				$( this ).prop( 'checked', false );
			});
		});
	}

	// Function to create a new Library from the 'Custom Libraries & Shortcodes' Tab.
	function wpbooklistCreateNewLibrary() {
		$( '#wpbooklist-dynamic-shortcode-button' ).click( function( event ) {
			var currentVal;
			currentVal = ( $( '#wpbooklist-dynamic-input-library' ).val()).toLowerCase();
			var data = {
				'action': 'wpbooklist_new_library_action',
				'currentval': currentVal,
				'security': wpbooklistPhpVariables.adminnonce4
			};

			$.post( ajaxurl, data, function( response ) {
				document.location.reload( true );
			});
		});
	}

	// Function to deleting Library from the 'Custom Libraries & Shortcodes' Tab.
	function wpbooklistDeleteNewLibrary() {

		$( document ).on( 'click', '.wpbooklist_delete_custom_lib', function( event ) {
			var table = $( this ).attr( 'id' );
			console.log( table );
			var data = {
				'action': 'wpbooklist_delete_library_action',
				'table': table,
				'security': wpbooklistPhpVariables.adminnonce5
			};

			var request = $.ajax({
				url: ajaxurl,
				type: 'POST',
				data: data,
				timeout: 0,
				success: function( response ) {
					console.log( response )
					document.location.reload( true );
				},
				error: function( jqXHR, textStatus, errorThrown ) {
					console.log( errorThrown );
					console.log( textStatus );
					console.log( jqXHR );
				}
			});
		});

	}




	// function for saving library display options
	function wpbooklistSaveLibraryDisplayOptions() {

		$( '#wpbooklist-save-backend' ).click( function( event ) {
			var enablepurchase = $( "input[name='enable-purchase-link']" ).prop( 'checked' );
			var hidesearch = $( "input[name='hide-search']" ).prop( 'checked' );
			var hidefacebook = $( "input[name='hide-facebook']" ).prop( 'checked' );
			var hidetwitter = $( "input[name='hide-twitter']" ).prop( 'checked' );
			var hidegoogleplus = $( "input[name='hide-googleplus']" ).prop( 'checked' );
			var hidemessenger = $( "input[name='hide-messenger']" ).prop( 'checked' );
			var hidepinterest = $( "input[name='hide-pinterest']" ).prop( 'checked' );
			var hideemail = $( "input[name='hide-email']" ).prop( 'checked' );
			var hidestats = $( "input[name='hide-stats']" ).prop( 'checked' );
			var hidefilter = $( "input[name='hide-filter']" ).prop( 'checked' );
			var hidegoodreadswidget = $( "input[name='hide-goodreads']" ).prop( 'checked' );
			var hideamazonreview = $( "input[name='hide-amazon-review']" ).prop( 'checked' );
			var hidedescription = $( "input[name='hide-description']" ).prop( 'checked' );
			var hidesimilar = $( "input[name='hide-similar']" ).prop( 'checked' );
			var hidebooktitle = $( "input[name='hide-book-title']" ).prop( 'checked' );
			var hidebookimage = $( "input[name='hide-book-image']" ).prop( 'checked' );
			var hidefinished = $( "input[name='hide-finished']" ).prop( 'checked' );
			var hidefinishedsort = $( "input[name='hide-finished-sort']" ).prop( 'checked' );
			var hidesignedsort = $( "input[name='hide-signed-sort']" ).prop( 'checked' );
			var hidefirstsort = $( "input[name='hide-first-sort']" ).prop( 'checked' );
			var hidesubjectsort = $( "input[name='hide-subject-sort']" ).prop( 'checked' );
			var hidelibrarytitle = $( "input[name='hide-library-title']" ).prop( 'checked' );
			var hideauthor = $( "input[name='hide-author']" ).prop( 'checked' );
			var hidecategory = $( "input[name='hide-category']" ).prop( 'checked' );
			var hidepages = $( "input[name='hide-pages']" ).prop( 'checked' );
			var hidebookpage = $( "input[name='hide-book-page']" ).prop( 'checked' );
			var hidebookpost = $( "input[name='hide-book-post']" ).prop( 'checked' );
			var hidepublisher = $( "input[name='hide-publisher']" ).prop( 'checked' );
			var hidepubdate = $( "input[name='hide-pub-date']" ).prop( 'checked' );
			var hidesigned = $( "input[name='hide-signed']" ).prop( 'checked' );
			var hidesubject = $( "input[name='hide-subject']" ).prop( 'checked' );
			var hidecountry = $( "input[name='hide-country']" ).prop( 'checked' );
			var hidefirstedition = $( "input[name='hide-first-edition']" ).prop( 'checked' );
			var hidefeaturedtitles = $( "input[name='hide-featured-titles']" ).prop( 'checked' );
			var hidenotes = $( "input[name='hide-notes']" ).prop( 'checked' );
			var hidequotebook = $( "input[name='hide-quote-book']" ).prop( 'checked' );
			var hidequote = $( "input[name='hide-quote']" ).prop( 'checked' );
			var hideratingbook = $( "input[name='hide-rating-book']" ).prop( 'checked' );
			var hiderating = $( "input[name='hide-rating']" ).prop( 'checked' );
			var hidegooglepurchase = $( "input[name='hide-google-purchase']" ).prop( 'checked' );
			var hideamazonpurchase = $( "input[name='hide-amazon-purchase']" ).prop( 'checked' );
			var hidebnpurchase = $( "input[name='hide-bn-purchase']" ).prop( 'checked' );
			var hideitunespurchase = $( "input[name='hide-itunes-purchase']" ).prop( 'checked' );
			var hidefrontendbuyimg = $( "input[name='hide-frontend-buy-img']" ).prop( 'checked' );
			var hidefrontendbuyprice = $( "input[name='hide-frontend-buy-price']" ).prop( 'checked' );
			var hidecolorboxbuyimg = $( "input[name='hide-colorbox-buy-img']" ).prop( 'checked' );
			var hidecolorboxbuyprice = $( "input[name='hide-colorbox-buy-price']" ).prop( 'checked' );
			var hidekindleprev = $( "input[name='hide-frontend-kindle-preview']" ).prop( 'checked' );
			var hidegoogleprev = $( "input[name='hide-frontend-google-preview']" ).prop( 'checked' );
			var hidebampurchase = $( "input[name='hide-bam-purchase']" ).prop( 'checked' );
			var hidekobopurchase = $( "input[name='hide-kobo-purchase']" ).prop( 'checked' );
			var sortoption = $( '#wpbooklist-jre-sorting-select' ).val();
			var booksonpage = $( "input[name='books-per-page']" ).val();
			var library = $( '#wpbooklist-library-settings-select' ).val();

			// Setting some variables to '' if they weren't found in DOM, due to not having an active WPBookList Extension
			if (hidegoogleprev == '' || hidegoogleprev == undefined ) {
				hidegoogleprev = '';
			}

			if ( enablepurchase == '' || enablepurchase == undefined ) {
				enablepurchase = '';
			}

			if (hidefrontendbuyimg == '' || hidefrontendbuyimg == undefined ) {
				hidefrontendbuyimg = '';
			}

			if (hidecolorboxbuyimg == '' || hidecolorboxbuyimg == undefined ) {
				hidecolorboxbuyimg = '';
			}

			if (hidecolorboxbuyprice == '' || hidecolorboxbuyprice == undefined ) {
				hidecolorboxbuyprice = '';
			}

			if (hidefrontendbuyprice == '' || hidefrontendbuyprice == undefined ) {
				hidefrontendbuyprice = '';
			}

			if (hidekindleprev == '' || hidekindleprev == undefined ) {
				hidekindleprev = '';
			}

			var data = {
				'action': 'wpbooklist_dashboard_save_library_display_options_action',
				'security': wpbooklistPhpVariables.adminnonce6,
				'enablepurchase': enablepurchase,
				'hidesearch': hidesearch,
				'hidefacebook': hidefacebook,
				'hidetwitter': hidetwitter,
				'hidegoogleplus': hidegoogleplus,
				'hidemessenger': hidemessenger,
				'hidepinterest': hidepinterest,
				'hideemail': hideemail,
				'hidestats': hidestats,
				'hidefilter': hidefilter,
				'hidegoodreadswidget': hidegoodreadswidget,
				'hideamazonreview': hideamazonreview,
				'hidedescription': hidedescription,
				'hidesimilar': hidesimilar,
				'hidebooktitle': hidebooktitle,
				'hidebookimage': hidebookimage,
				'hidefinished': hidefinished,
				'hidefinishedsort': hidefinishedsort,
				'hidesignedsort': hidesignedsort,
				'hidefirstsort': hidefirstsort,
				'hidesubjectsort': hidesubjectsort,
				'hidelibrarytitle': hidelibrarytitle,
				'hideauthor': hideauthor,
				'hidecategory': hidecategory,
				'hidepages': hidepages,
				'hidebookpage': hidebookpage,
				'hidebookpost': hidebookpost,
				'hidepublisher': hidepublisher,
				'hidepubdate': hidepubdate,
				'hidesigned': hidesigned,
				'hidesubject': hidesubject,
				'hidecountry': hidecountry,
				'hidefirstedition': hidefirstedition,
				'hidefeaturedtitles': hidefeaturedtitles,
				'hidenotes': hidenotes,
				'hidequotebook': hidequotebook,
				'hidequote': hidequote,
				'hideratingbook': hideratingbook,
				'hiderating': hiderating,
				'hidegooglepurchase': hidegooglepurchase,
				'hideamazonpurchase': hideamazonpurchase,
				'hidebnpurchase': hidebnpurchase,
				'hideitunespurchase': hideitunespurchase,
				'hidefrontendbuyimg': hidefrontendbuyimg,
				'hidecolorboxbuyimg': hidecolorboxbuyimg,
				'hidecolorboxbuyprice': hidecolorboxbuyprice,
				'hidefrontendbuyprice': hidefrontendbuyprice,
				'hidekindleprev': hidekindleprev,
				'hidegoogleprev': hidegoogleprev,
				'hidekobopurchase': hidekobopurchase,
				'hidebampurchase': hidebampurchase,
				'sortoption': sortoption,
				'booksonpage': booksonpage,
				'library': library
			};
			console.log( data );

			var request = $.ajax({
				url: ajaxurl,
				type: 'POST',
				data: data,
				timeout: 0,
				success: function( response ) {
					document.location.reload( true );
				},
				error: function( jqXHR, textStatus, errorThrown ) {
					console.log( errorThrown );
					console.log( textStatus );
					console.log( jqXHR );
				}
			});

			event.preventDefault ? event.preventDefault() : event.returnValue = false;
		});
	}




	// function for saving post display options
	function wpbooklistSavePostDisplayOptions() {

		$( '#wpbooklist-save-post-backend' ).click( function( event ) {

			var enablepurchase = $( "input[name='enable-purchase-link']" ).prop( 'checked' );
			var hidefacebook = $( "input[name='hide-facebook']" ).prop( 'checked' );
			var hidetwitter = $( "input[name='hide-twitter']" ).prop( 'checked' );
			var hidegoogleplus = $( "input[name='hide-googleplus']" ).prop( 'checked' );
			var hidemessenger = $( "input[name='hide-messenger']" ).prop( 'checked' );
			var hidepinterest = $( "input[name='hide-pinterest']" ).prop( 'checked' );
			var hideemail = $( "input[name='hide-email']" ).prop( 'checked' );
			var hideamazonreview = $( "input[name='hide-amazon-review']" ).prop( 'checked' );
			var hidedescription = $( "input[name='hide-description']" ).prop( 'checked' );
			var hidesimilar = $( "input[name='hide-similar']" ).prop( 'checked' );
			var hidetitle = $( "input[name='hide-book-title']" ).prop( 'checked' );
			var hidebookimage = $( "input[name='hide-book-image']" ).prop( 'checked' );
			var hidefinished = $( "input[name='hide-finished']" ).prop( 'checked' );
			var hideauthor = $( "input[name='hide-author']" ).prop( 'checked' );
			var hidecategory = $( "input[name='hide-category']" ).prop( 'checked' );
			var hidepages = $( "input[name='hide-pages']" ).prop( 'checked' );
			var hidepublisher = $( "input[name='hide-publisher']" ).prop( 'checked' );
			var hidepubdate = $( "input[name='hide-pub-date']" ).prop( 'checked' );
			var hidesigned = $( "input[name='hide-signed']" ).prop( 'checked' );
			var hidesubject = $( "input[name='hide-subject']" ).prop( 'checked' );
			var hidecountry = $( "input[name='hide-country']" ).prop( 'checked' );
			var hidefirstedition = $( "input[name='hide-first-edition']" ).prop( 'checked' );
			var hidefeaturedtitles = $( "input[name='hide-featured-titles']" ).prop( 'checked' );
			var hidenotes = $( "input[name='hide-notes']" ).prop( 'checked' );
			var hidequote = $( "input[name='hide-quote']" ).prop( 'checked' );
			var hiderating = $( "input[name='hide-rating']" ).prop( 'checked' );
			var hidegooglepurchase = $( "input[name='hide-google-purchase']" ).prop( 'checked' );
			var hideamazonpurchase = $( "input[name='hide-amazon-purchase']" ).prop( 'checked' );
			var hidebnpurchase = $( "input[name='hide-bn-purchase']" ).prop( 'checked' );
			var hideitunespurchase = $( "input[name='hide-itunes-purchase']" ).prop( 'checked' );
			var hidefrontendbuyimg = $( "input[name='hide-frontend-buy-img']" ).prop( 'checked' );
			var hidecolorboxbuyimg = $( "input[name='hide-colorbox-buy-img']" ).prop( 'checked' );
			var hidecolorboxbuyprice = $( "input[name='hide-colorbox-buy-price']" ).prop( 'checked' );
			var hidefrontendbuyprice = $( "input[name='hide-frontend-buy-price']" ).prop( 'checked' );
			var hidekindleprev = $( "input[name='hide-frontend-kindle-preview']" ).prop( 'checked' );
			var hidegoogleprev = $( "input[name='hide-frontend-google-preview']" ).prop( 'checked' );
			var hidekobopurchase = $( "input[name='hide-kobo-purchase']" ).prop( 'checked' );
			var hidebampurchase = $( "input[name='hide-bam-purchase']" ).prop( 'checked' );

			// Setting some variables to '' if they weren't found in DOM, due to not having an active WPBookList Extension
			if (hidegoogleprev == '' || hidegoogleprev == undefined ) {
				hidegoogleprev = '';
			}

			if ( enablepurchase == '' || enablepurchase == undefined ) {
				enablepurchase = '';
			}

			if (hidefrontendbuyimg == '' || hidefrontendbuyimg == undefined ) {
				hidefrontendbuyimg = '';
			}

			if (hidecolorboxbuyimg == '' || hidecolorboxbuyimg == undefined ) {
				hidecolorboxbuyimg = '';
			}

			if (hidecolorboxbuyprice == '' || hidecolorboxbuyprice == undefined ) {
				hidecolorboxbuyprice = '';
			}

			if (hidefrontendbuyprice == '' || hidefrontendbuyprice == undefined ) {
				hidefrontendbuyprice = '';
			}

			if (hidekindleprev == '' || hidekindleprev == undefined ) {
				hidekindleprev = '';
			}

			var data = {
				'action': 'wpbooklist_dashboard_save_post_display_options_action',
				'security': wpbooklistPhpVariables.adminnonce8,
				'enablepurchase': enablepurchase,
				'hidefacebook': hidefacebook,
				'hidetwitter': hidetwitter,
				'hidegoogleplus': hidegoogleplus,
				'hidemessenger': hidemessenger,
				'hidepinterest': hidepinterest,
				'hideemail': hideemail,
				'hideamazonreview': hideamazonreview,
				'hidedescription': hidedescription,
				'hidesimilar': hidesimilar,
				'hidetitle': hidetitle,
				'hidebookimage': hidebookimage,
				'hidefinished': hidefinished,
				'hideauthor': hideauthor,
				'hidecategory': hidecategory,
				'hidepages': hidepages,
				'hidepublisher': hidepublisher,
				'hidepubdate': hidepubdate,
				'hidesigned': hidesigned,
				'hidesubject': hidesubject,
				'hidecountry': hidecountry,
				'hidefirstedition': hidefirstedition,
				'hidefeaturedtitles': hidefeaturedtitles,
				'hidenotes': hidenotes,
				'hidequote': hidequote,
				'hiderating': hiderating,
				'hidegooglepurchase': hidegooglepurchase,
				'hideamazonpurchase': hideamazonpurchase,
				'hidebnpurchase': hidebnpurchase,
				'hideitunespurchase': hideitunespurchase,
				'hidefrontendbuyimg': hidefrontendbuyimg,
				'hidecolorboxbuyimg': hidecolorboxbuyimg,
				'hidecolorboxbuyprice': hidecolorboxbuyprice,
				'hidefrontendbuyprice': hidefrontendbuyprice,
				'hidekindleprev': hidekindleprev,
				'hidegoogleprev': hidegoogleprev,
				'hidebampurchase': hidebampurchase,
				'hidekobopurchase': hidekobopurchase,
			};
			console.log( data );

			var request = $.ajax({
				url: ajaxurl,
				type: 'POST',
				data: data,
				timeout: 0,
				success: function( response ) {
					document.location.reload( true );
				},
				error: function( jqXHR, textStatus, errorThrown ) {
					console.log( errorThrown );
					console.log( textStatus );
					console.log( jqXHR );
				}
			});

			event.preventDefault ? event.preventDefault() : event.returnValue = false;
		});
	}


	// function for saving post display options
	function wpbooklistSavePageDisplayOptions() {
		$( '#wpbooklist-save-page-backend' ).click( function( event ) {

			var enablepurchase = $( "input[name='enable-purchase-link']" ).prop( 'checked' );
			var hidefacebook = $( "input[name='hide-facebook']" ).prop( 'checked' );
			var hidetwitter = $( "input[name='hide-twitter']" ).prop( 'checked' );
			var hidegoogleplus = $( "input[name='hide-googleplus']" ).prop( 'checked' );
			var hidemessenger = $( "input[name='hide-messenger']" ).prop( 'checked' );
			var hidepinterest = $( "input[name='hide-pinterest']" ).prop( 'checked' );
			var hideemail = $( "input[name='hide-email']" ).prop( 'checked' );
			var hideamazonreview = $( "input[name='hide-amazon-review']" ).prop( 'checked' );
			var hidedescription = $( "input[name='hide-description']" ).prop( 'checked' );
			var hidesimilar = $( "input[name='hide-similar']" ).prop( 'checked' );
			var hidetitle = $( "input[name='hide-book-title']" ).prop( 'checked' );
			var hidebookimage = $( "input[name='hide-book-image']" ).prop( 'checked' );
			var hidefinished = $( "input[name='hide-finished']" ).prop( 'checked' );
			var hideauthor = $( "input[name='hide-author']" ).prop( 'checked' );
			var hidecategory = $( "input[name='hide-category']" ).prop( 'checked' );
			var hidepages = $( "input[name='hide-pages']" ).prop( 'checked' );
			var hidepublisher = $( "input[name='hide-publisher']" ).prop( 'checked' );
			var hidepubdate = $( "input[name='hide-pub-date']" ).prop( 'checked' );
			var hidesigned = $( "input[name='hide-signed']" ).prop( 'checked' );
			var hidesubject = $( "input[name='hide-subject']" ).prop( 'checked' );
			var hidecountry = $( "input[name='hide-country']" ).prop( 'checked' );
			var hidefirstedition = $( "input[name='hide-first-edition']" ).prop( 'checked' );
			var hidefeaturedtitles = $( "input[name='hide-featured-titles']" ).prop( 'checked' );
			var hidenotes = $( "input[name='hide-notes']" ).prop( 'checked' );
			var hidequote = $( "input[name='hide-quote']" ).prop( 'checked' );
			var hiderating = $( "input[name='hide-rating']" ).prop( 'checked' );
			var hidegooglepurchase = $( "input[name='hide-google-purchase']" ).prop( 'checked' );
			var hideamazonpurchase = $( "input[name='hide-amazon-purchase']" ).prop( 'checked' );
			var hidebnpurchase = $( "input[name='hide-bn-purchase']" ).prop( 'checked' );
			var hideitunespurchase = $( "input[name='hide-itunes-purchase']" ).prop( 'checked' );
			var hidefrontendbuyimg = $( "input[name='hide-frontend-buy-img']" ).prop( 'checked' );
			var hidecolorboxbuyimg = $( "input[name='hide-colorbox-buy-img']" ).prop( 'checked' );
			var hidecolorboxbuyprice = $( "input[name='hide-colorbox-buy-price']" ).prop( 'checked' );
			var hidefrontendbuyprice = $( "input[name='hide-frontend-buy-price']" ).prop( 'checked' );
			var hidekindleprev = $( "input[name='hide-frontend-kindle-preview']" ).prop( 'checked' );
			var hidegoogleprev = $( "input[name='hide-frontend-google-preview']" ).prop( 'checked' );
			var hidebampurchase = $( "input[name='hide-bam-purchase']" ).prop( 'checked' );
			var hidekobopurchase = $( "input[name='hide-kobo-purchase']" ).prop( 'checked' );


			// Setting some variables to '' if they weren't found in DOM, due to not having an active WPBookList Extension
			if (hidegoogleprev == '' || hidegoogleprev == undefined ) {
				hidegoogleprev = '';
			}

			if ( enablepurchase == '' || enablepurchase == undefined ) {
				enablepurchase = '';
			}

			if (hidefrontendbuyimg == '' || hidefrontendbuyimg == undefined ) {
				hidefrontendbuyimg = '';
			}

			if (hidecolorboxbuyimg == '' || hidecolorboxbuyimg == undefined ) {
				hidecolorboxbuyimg = '';
			}

			if (hidecolorboxbuyprice == '' || hidecolorboxbuyprice == undefined ) {
				hidecolorboxbuyprice = '';
			}

			if (hidefrontendbuyprice == '' || hidefrontendbuyprice == undefined ) {
				hidefrontendbuyprice = '';
			}

			if (hidekindleprev == '' || hidekindleprev == undefined ) {
				hidekindleprev = '';
			}

			var data = {
				'action': 'wpbooklist_dashboard_save_page_display_options_action',
				'security': wpbooklistPhpVariables.adminnonce7,
				'enablepurchase': enablepurchase,
				'hidefacebook': hidefacebook,
				'hidetwitter': hidetwitter,
				'hidegoogleplus': hidegoogleplus,
				'hidemessenger': hidemessenger,
				'hidepinterest': hidepinterest,
				'hideemail': hideemail,
				'hideamazonreview': hideamazonreview,
				'hidedescription': hidedescription,
				'hidesimilar': hidesimilar,
				'hidetitle': hidetitle,
				'hidebookimage': hidebookimage,
				'hidefinished': hidefinished,
				'hideauthor': hideauthor,
				'hidecategory': hidecategory,
				'hidepages': hidepages,
				'hidepublisher': hidepublisher,
				'hidepubdate': hidepubdate,
				'hidesigned': hidesigned,
				'hidesubject': hidesubject,
				'hidecountry': hidecountry,
				'hidefirstedition': hidefirstedition,
				'hidefeaturedtitles': hidefeaturedtitles,
				'hidenotes': hidenotes,
				'hidequote': hidequote,
				'hiderating': hiderating,
				'hidegooglepurchase': hidegooglepurchase,
				'hideamazonpurchase': hideamazonpurchase,
				'hidebnpurchase': hidebnpurchase,
				'hideitunespurchase': hideitunespurchase,
				'hidefrontendbuyimg': hidefrontendbuyimg,
				'hidecolorboxbuyimg': hidecolorboxbuyimg,
				'hidecolorboxbuyprice': hidecolorboxbuyprice,
				'hidefrontendbuyprice': hidefrontendbuyprice,
				'hidekindleprev': hidekindleprev,
				'hidegoogleprev': hidegoogleprev,
				'hidekobopurchase': hidekobopurchase,
				'hidebampurchase': hidebampurchase
			};
			console.log( data );

			var request = $.ajax({
				url: ajaxurl,
				type: 'POST',
				data: data,
				timeout: 0,
				success: function( response ) {
					document.location.reload( true );
				},
				error: function( jqXHR, textStatus, errorThrown ) {
					console.log( errorThrown );
					console.log( textStatus );
					console.log( jqXHR );
				}
			});

			event.preventDefault ? event.preventDefault() : event.returnValue = false;
		});
	}

	// Function for changing the Library on the Library tab of the Display Options menu.
	function wpbooklistChangeLibraryDisplayOptionsLibrary() {

		$( '#wpbooklist-library-settings-select' ).on( 'change', function( event ) {

			var optionsTable = $( '#wpbooklist-jre-backend-options-table' );
			var lowerTable = $( '#wpbooklist-library-options-lower-table' );
			var lowerTableInput = $( '#wpbooklist-library-options-lower-table input' );
			var optionsTableInput = $( '#wpbooklist-jre-backend-options-table input' );
			var spinner = $( '#wpbooklist-spinner-2' );
			var library = $( '#wpbooklist-library-settings-select' ).val();
			var saveChanges = $( '#wpbooklist-save-backend' );
			spinner.animate({ 'opacity': '1'}, 200 );
			optionsTable.animate({ 'opacity': '0.3'}, 500 );
			lowerTable.animate({ 'opacity': '0.3'}, 500 );
			lowerTable.animate({ 'opacity': '0.3'}, 500 );
			saveChanges.animate({ 'opacity': '0.3'}, 500 );
			saveChanges.attr( 'disabled', true );
			lowerTableInput.attr( 'disabled', true );

			var settingsArray = {
				'enablepurchase': 'enable-purchase-link',
				'hidesearch': 'hide-search',
				'hidefacebook': 'hide-facebook',
				'hidetwitter': 'hide-twitter',
				'hidegoogleplus': 'hide-googleplus',
				'hidemessenger': 'hide-messenger',
				'hidepinterest': 'hide-pinterest',
				'hideemail': 'hide-email',
				'hidestats': 'hide-stats',
				'hidefilter': 'hide-filter',
				'hidegoodreadswidget': 'hide-goodreads',
				'hideamazonreview': 'hide-amazon-review',
				'hidedescription': 'hide-description',
				'hidesimilar': 'hide-similar',
				'hidebooktitle': 'hide-book-title',
				'hidebookimage'  : 'hide-book-image',
				'hidefinished': 'hide-finished',
				'hidelibrarytitle': 'hide-library-title',
				'hideauthor': 'hide-author',
				'hidecategory': 'hide-category',
				'hidepages': 'hide-pages',
				'hidebookpage': 'hide-book-page',
				'hidebookpost': 'hide-book-post',
				'hidepublisher': 'hide-publisher',
				'hidepubdate': 'hide-pub-date',
				'hidesigned': 'hide-signed',
				'hidesubject': 'hide-subject',
				'hidecountry': 'hide-country',
				'hidefinishedsort': 'hide-finished-sort',
				'hidesignedsort': 'hide-signed-sort',
				'hidefirstsort': 'hide-first-sort',
				'hidesubjectsort': 'hide-subject-sort',
				'hidefirstedition': 'hide-first-edition',
				'hidefeaturedtitles': 'hide-featured-titles',
				'hidenotes': 'hide-notes',
				'hidequotebook': 'hide-quote-book',
				'hidequote': 'hide-quote',
				'hideratingbook': 'hide-rating-book',
				'hiderating': 'hide-rating',
				'hidegooglepurchase': 'hide-google-purchase',
				'hideamazonpurchase': 'hide-amazon-purchase',
				'hidebnpurchase': 'hide-bn-purchase',
				'hideitunespurchase': 'hide-itunes-purchase',
				'hidefrontendbuyimg': 'hide-frontend-buy-img',
				'hidecolorboxbuyimg': 'hide-colorbox-buy-img',
				'hidecolorboxbuyprice': 'hide-colorbox-buy-price',
				'hidefrontendbuyprice': 'hide-frontend-buy-price',
				'hidekindleprev': 'hide-frontend-kindle-preview',
				'hidegoogleprev': 'hide-frontend-google-preview',
				'hidebampurchase': 'hide-bam-purchase',
				'hidekobopurchase': 'hide-kobo-purchase',
				'sortoption': 'sortoption',
				'booksonpage': 'booksonpage',
				'library': 'library',
				'booksonpage': 'books-per-page'
			};

			console.log( settingsArray);

			var data = {
				'action': 'wpbooklist_change_library_display_options_action',
				'security': wpbooklistPhpVariables.adminnonce9,
				'library': library
			};
			console.log( data );

			var request = $.ajax({
				url: ajaxurl,
				type: 'POST',
				data: data,
				timeout: 0,
				success: function( response ) {
					response = JSON.parse( response );
					console.log( response )
					optionsTable.animate({ 'opacity': '1'}, 500 );
					lowerTable.animate({ 'opacity': '1'}, 500 );
					saveChanges.animate({ 'opacity': '1'}, 500 );
					saveChanges.attr( 'disabled', false );
					optionsTableInput.attr( 'disabled', false );
					lowerTableInput.attr( 'disabled', false );
					spinner.animate({ 'opacity': '0'}, 200 );
					for ( var key in response ) {
					if ( response.hasOwnProperty(key)) {
						if ( response[key] == 1 ) {
							var obj = $( "input[name='" +settingsArray[key] + "']" ).prop( 'checked', true );
						}

						if ( response[key] == 0 || response[key] == null ) {
							var obj = $( "input[name='" +settingsArray[key] + "']" ).prop( 'checked', false );
						}

						if (key == 'booksonpage' ) {
							var obj = $( "input[name='books-per-page']" ).val( response[key]);
						}

						if (key == 'sortoption' ) {
							var obj = $( '#wpbooklist-jre-sorting-select' ).val( response[key]);
						}

					}
					}
				},
				error: function( jqXHR, textStatus, errorThrown ) {
					console.log( errorThrown );
					console.log( textStatus );
					console.log( jqXHR );
				}
			});

			event.preventDefault ? event.preventDefault() : event.returnValue = false;
		});
	}

	// Function for showing the Edit Book form.
	function wpbooklistEditBookShowForm() {
		$( document ).on( 'click', '.wpbooklist-edit-actions-edit-button', function( event ) {

			// Gather info needed to return book data
			var bookId = $( this ).attr( 'data-book-id' );
			var table = $( this ).attr( 'data-table' );
			var key = $( this ).attr( 'data-key' );

			// Clear any edit book forms that may already be in dom
			$( '.wpbooklist-edit-form-div' ).html( '' );

			// Show spinner
			$( '#wpbooklist-spinner-' +key).animate({ 'opacity': '1' });

			var data = {
				'action': 'wpbooklist_edit_book_show_form_action',
				'security': wpbooklistPhpVariables.adminnonce10,
				'bookId': bookId,
				'table': table
			};

			var request = $.ajax({
				url: ajaxurl,
				type: 'POST',
				data: data,
				timeout: 0,
				success: function( response ) {

					
	
					// Parse out the response.
					response = response.split( '–sep-seperator-sep–' );
					var bookInfo = JSON.parse( response[0]);
					var editForm = response[1];
					
					// Add the edit book form into dom and show
					$( '#wpbooklist-edit-form-div-' +key).html( editForm);
					
					$( '#wpbooklist-edit-form-div-' +key).animate({ 'opacity': '1' });

					$( '#wpbooklist-admin-cancel-button' ).attr( 'data-key', key);

					// Hide spinner
					$( '#wpbooklist-spinner-' +key).animate({ 'opacity': '0' });

					// Populate all edit book form fields
					$( '#wpbooklist-editbook-isbn' ).val( bookInfo.isbn );
					$( '#wpbooklist-editbook-title' ).val( bookInfo.title );
					$( '#wpbooklist-editbook-author' ).val( bookInfo.author);
					$( '#wpbooklist-editbook-category' ).val( bookInfo.category);
					$( '#wpbooklist-editbook-price' ).val( bookInfo.price );
					$( '#wpbooklist-editbook-pages' ).val( bookInfo.pages );
					$( '#wpbooklist-editbook-pubdate' ).val( bookInfo.pub_year);
					$( '#wpbooklist-editbook-publisher' ).val( bookInfo.publisher);
					$( '#wpbooklist-editbook-subject' ).val( bookInfo.subject );
					$( '#wpbooklist-editbook-country' ).val( bookInfo.country);
					$( '#wpbooklist-editbook-sale-author-link' ).val( bookInfo.author_url );

					// Populate the purchase links/URLs section
					$( '#wpbooklist-editbook-books-a-million-buy-link' ).val( bookInfo.bam_link)
					$( '#wpbooklist-editbook-amazon-buy-link' ).val( bookInfo.amazon_detail_page )
					$( '#wpbooklist-editbook-bn-link' ).val( bookInfo.bn_link)
					$( '#wpbooklist-editbook-google-play-buy-link' ).val( bookInfo.google_preview)
					$( '#wpbooklist-editbook-itunes-link' ).val( bookInfo.itunes_page )
					$( '#wpbooklist-editbook-kobo-link' ).val( bookInfo.kobo_link)




					if ( bookInfo.page_yes == 'false' || bookInfo.page_yes == null || bookInfo.page_yes == undefined ) {
					$( '#wpbooklist-editbook-page-no' ).prop( 'checked', true );
					$( '#wpbooklist-editbook-page-yes' ).attr( 'data-page-id', bookInfo.page_yes );
					} else {
					$( '#wpbooklist-editbook-page-yes' ).prop( 'checked', true );
					$( '#wpbooklist-editbook-page-yes' ).attr( 'data-page-id', bookInfo.page_yes );
					}

					if ( bookInfo.post_yes == 'false' || bookInfo.post_yes == null || bookInfo.post_yes == undefined ) {
					$( '#wpbooklist-editbook-post-no' ).prop( 'checked', true );
					$( '#wpbooklist-editbook-post-yes' ).attr( 'data-post-id', bookInfo.post_yes );
					} else {
					$( '#wpbooklist-editbook-post-yes' ).prop( 'checked', true );
					$( '#wpbooklist-editbook-post-yes' ).attr( 'data-post-id', bookInfo.post_yes );
					}

					var decoded = $( '<textarea/>' ).html( bookInfo.description ).text();
					var decoded2 = $( '<textarea/>' ).html( decoded ).text();
					decoded2 = decoded2.replace(/\\/g, '' );

					$( '#wpbooklist-editbook-description' ).val( decoded2);

					var decoded = $( '<textarea/>' ).html( bookInfo.notes ).text();
					var decoded2 = $( '<textarea/>' ).html( decoded ).text();
					decoded2 = decoded2.replace(/\\/g, '' );

					$( '#wpbooklist-editbook-notes' ).val( decoded2);

					if ( bookInfo.rating != null && bookInfo.rating != 0 ) {
					$( '#wpbooklist-editbook-rating' ).val( bookInfo.rating)
					}

					$( '#wpbooklist-editbook-image' ).val( bookInfo.image );
					$( '#wpbooklist-editbook-preview-img' ).attr( 'src', bookInfo.image )

					$( '#wpbooklist-admin-editbook-button' ).attr( 'data-book-id', bookId );
					$( '#wpbooklist-admin-editbook-button' ).attr( 'data-book-uid', bookInfo.book_uid );

					if ( bookInfo.lendable == 'true' ) {
					$( '#wpbooklist-addbook-bookswapper-yes' ).prop( 'checked', true );
					} else {
					$( '#wpbooklist-addbook-bookswapper-no' ).prop( 'checked', true );
					}

					$( '#wpbooklist-bookswapper-copies' ).val( bookInfo.copies );


					if ( bookInfo.finished == 'true' ) {
					$( '#wpbooklist-editbook-finished-yes' ).prop( 'checked', true );

					var dateFinished = bookInfo.date_finished.split( '-' );
					dateFinished = dateFinished[2] + '-' +dateFinished[0] + '-' +dateFinished[1];

					$( '#wpbooklist-editbook-date-finished' ).val( dateFinished )
					$( '#wpbooklist-editbook-date-finished' ).css({ 'opacity': '1' });
					} else {
					$( '#wpbooklist-editbook-finished-no' ).prop( 'checked', true );
					}

					if ( bookInfo.signed == 'true' ) {
					$( '#wpbooklist-editbook-signed-yes' ).prop( 'checked', true );
					} else {
					$( '#wpbooklist-editbook-signed-no' ).prop( 'checked', true );
					}

					if ( bookInfo.first_edition == 'true' ) {
					$( '#wpbooklist-editbook-firstedition-yes' ).prop( 'checked', true );
					} else {
					$( '#wpbooklist-editbook-firstedition-no' ).prop( 'checked', true );
					}

					// Populate all WooCommerce fields
					if ( response[2] != 'null' ) {

					var crosssellsids = '';
					var crosssellstitles = '';
					var upsellsids = '';
					var upsellstitles = '';
					var cat = '';
					var filename = '';

					if ( response[3] != 'null' ) {
						var storefront = response[3];
						// Activate the select2 code if the storefront extension is active
						if ( storefront == 'true' ) {
							$( '.select2-input' ).select2();
						}
						}

						if ( response[4] != 'null' ) {
						crosssellsids = response[4];
						}

						if ( response[5] != 'null' ) {
						crosssellstitles = response[5];

						crosssellstitles = response[5];
						if ( crosssellstitles.includes( ', ' ) ) {
							var crosssellArray = crosssellstitles.split( ', ' );
						} else {
							var crosssellArray = crosssellstitles;
						}

						$( '#select2-crosssells' ).val( crosssellArray).trigger( 'change' );
						}

						if ( response[6] != 'null' ) {
						upsellsids = response[6];
						}

						if ( response[7] != 'null' ) {
						upsellstitles = response[7];
						if ( upsellstitles.includes( ', ' ) ) {
							var upsellArray = upsellstitles.split( ', ' );
						} else {
							var upsellArray = upsellstitles;
						}

						$( '#select2-upsells' ).val( upsellArray).trigger( 'change' );
					}

					if ( response[8] != 'null' ) {
						cat = response[8];
					}

					if ( response[9] != 'null' ) {
						filename = response[9];
					}

					var productInfo = JSON.parse( response[2]);
					console.log(productInfo);
					// Populate all WooCommerce fields
					if ( bookInfo.woocommerce != '' && bookInfo.woocommerce != null ) {
						$( '#wpbooklist-woocommerce-yes' ).prop( 'checked', true );
						$( '.wpbooklist-woo-row' ).css({ 'opacity': '1', 'display': 'table-row' });

						$( '#wpbooklist-addbook-woo-regular-woo-price' ).val(productInfo._price )
						$( '#wpbooklist-addbook-woo-sale-price' ).val(productInfo._sale_price )
						$( '#wpbooklist-addbook-woo-salebegin' ).val(productInfo._sale_price_dates_from)
						$( '#wpbooklist-addbook-woo-saleend' ).val(productInfo._sale_price_dates_to)
						$( '#wpbooklist-addbook-woo-width' ).val(productInfo._width)
						$( '#wpbooklist-addbook-woo-height' ).val(productInfo._height )
						$( '#wpbooklist-addbook-woo-length' ).val(productInfo._length)
						$( '#wpbooklist-addbook-woo-weight' ).val(productInfo._weight )
						$( '#wpbooklist-addbook-woo-sku' ).val(productInfo._sku)
						$( '#wpbooklist-addbook-woo-stock' ).val(productInfo._stock)
						$( '#wpbooklist-editbook-woo-note' ).val(productInfo._purchase_note )

						

						$( '#wpbooklist-woocommerce-category-select' ).val( cat );

						if (productInfo._virtual == 'true' ) {
							$( '#wpbooklist-woocommerce-vert-yes' ).prop( 'checked', true );
							$( '#wpbooklist-woo-row-upload' ).css({ 'opacity': '1', 'display': 'table-row' });
						}

						if (productInfo._downloadable == 'true' ) {
							$( '#wpbooklist-woocommerce-download-yes' ).prop( 'checked', true )
							$( '#wpbooklist-woocommerce-download-no' ).prop( 'checked', false )
							$( '.wpbooklist-woo-row-upload' ).css({ 'opacity': '1', 'display': 'table-row' });
						}

						if (filename != '' && filename != null && filename != undefined ) {
							$( '#wpbooklist-storefront-uploaded-files-title' ).html(filename )
						}

						if ( response[10] != '' && response[10]  != null && response[10]  != undefined ) {
							$( '#wpbooklist-storefront-preview-img-1' ).attr( 'data-id', response[10]);
						}

console.log( response[7])
						//$( '#wpbooklist-woocommerce-review-yes' )



						

					}
					}

				},
				error: function( jqXHR, textStatus, errorThrown ) {
					console.log( errorThrown );
					console.log( textStatus );
					console.log( jqXHR );
				}
			});

			event.preventDefault ? event.preventDefault() : event.returnValue = false;
		});

		// If the 'Cancel' button is clicked, reset all UI/Dom elements
		$( document ).on( 'click', '#wpbooklist-admin-cancel-button', function( event ) {

			var key = $( this ).attr( 'data-key' );
			var scrollTop = $( '#wpbooklist-edit-book-indiv-div-id-' +key).offset().top-50

			// Clear any edit book forms that may already be in dom and hide edit form
			$( '.wpbooklist-edit-form-div' ).animate({ 'opacity': '0' });
			$( '.wpbooklist-edit-book-indiv-div-class' ).animate({ 'height': '100'},500 )

			$( '.wpbooklist-edit-book-indiv-div-class' ).animate({
				'height': '100'
			}, {
				queue: false,
				duration: 500,
				complete: function() {
					$( '.wpbooklist-edit-form-div' ).html( '' );
					$( '.wpbooklist-edit-book-indiv-div-class' ).css({ 'height': 'auto' });

					// Scrolls back to the top of the title 
					if ( scrollTop != 0 ) {
					$( 'html, body' ).animate({
						scrollTop: scrollTop
					}, 500 );
					scrollTop = 0;
					}


				}
			});
		});
	}

	// Function for switching to the next page of books on the 'Edit & Delete Books' tab
	function wpbooklistEditBookPagination() {
		// Set initial offset in dom
		$( '.wpbooklist-admin-tp-top-title' ).attr( 'data-offset', 0 );
		
		// Get offset value from wpbooklist.php, convert to int
		var offset = wpbooklistPhpVariables.EDIT_PAGE_OFFSET;
		offset = parseInt(offset );


		$( document ).on( 'click', '#wpbooklist-edit-next-100, #wpbooklist-edit-previous-100', function( event ) {

			// Grabbing library
			var library =  $( '#wpbooklist-editbook-select-library' ).val();

			// Grabbing offset from dom
			var currentOffset = parseInt( $( '.wpbooklist-admin-tp-top-title' ).attr( 'data-offset' ));

			// Grabbing total number of books in library
			var limit = parseInt( $( this ).attr( 'data-limit' ));

			// Ensuring we don't go backwards if we're already on the first set results
			if ( $( this ).attr( 'id' ) == 'wpbooklist-edit-previous-100' ) {
				var direction = 'back';
			} else {
				var direction = 'forward';
			}

			// Ensuring we don't go backwards if we're already on the first set results
			if ( direction == 'back' &&  ( currentOffset-offset ) < 0 ) {
				console.log( 'returnback' );
				return;
			}

			// Ensuring we don't go over the total # of books in library
			if ( direction == 'forward' &&  ( currentOffset+offset ) > limit ) {
				console.log( 'returnforward' );
				return;
			}

			// Initial UI Stuff
			$( '.wpbooklist-edit-book-indiv-div-class' ).animate({ 'opacity': '0.3'}, 500 );
			$( '#wpbooklist-spinner-pagination' ).animate({ 'opacity': '1'},500 );

			if ( direction == 'forward' ) {
				currentOffset = currentOffset+offset;
				$( '.wpbooklist-admin-tp-top-title' ).attr( 'data-offset', currentOffset );
			} else {
				currentOffset = currentOffset-offset;
				$( '.wpbooklist-admin-tp-top-title' ).attr( 'data-offset', currentOffset );
			}

			var data = {
				'action': 'wpbooklist_edit_book_pagination_action',
				'security': wpbooklistPhpVariables.adminnonce11,
				'currentOffset': currentOffset,
				'library': library
			};

			var request = $.ajax({
				url: ajaxurl,
				type: 'POST',
				data: data,
				timeout: 0,
				success: function( response ) {

					response = response.split( '_Separator_' );

					// Resetting iniail UI stuff
					$( '.wpbooklist-edit-book-indiv-div-class' ).animate({ 'opacity': '1'}, 500 );
					$( '#wpbooklist-spinner-pagination' ).animate({ 'opacity': '0'},500 );

					// Clear existing books and replace with the response
					$( '.wpbooklist-admin-tp-inner-container' ).html( '' );
					$( '.wpbooklist-admin-tp-inner-container' ).html( response[0]);

					// Resetting table drop-down
					$( '#wpbooklist-editbook-select-library' ).val( response[1]);

					if ( direction == 'back' &&  ( currentOffset-offset ) < 0 ) {
						$( '#wpbooklist-edit-previous-100' ).css({ 'pointer-events': 'none', 'opacity': '0.3' });
					} else {
						$( '#wpbooklist-edit-previous-100' ).css({ 'pointer-events': 'all', 'opacity': '1' });
					}

					if ( direction == 'forward' &&  ( currentOffset+offset ) > limit ) {
						$( '#wpbooklist-edit-next-100' ).css({ 'pointer-events': 'none', 'opacity': '0.3' });
					} else {
						$( '#wpbooklist-edit-next-100' ).css({ 'pointer-events': 'all', 'opacity': '1' });
					}

					$( 'html, body' ).animate({
						scrollTop: $( '#wpbooklist-bulk-edit-mode-on-button' ).offset().top-100
					}, 1000 );
				}

			});
		});
	}

	// Function for switching libraries on the Edit Book tab.
	function wpbooklistEditBookSwitchLib() {
		$( document ).on( 'change', '#wpbooklist-editbook-select-library', function( event ) {

			var library =  $( '#wpbooklist-editbook-select-library' ).val();

			if ( window.location.href.includes( 'library=' ) && window.location.href.includes( 'tab=' ) && window.location.href.includes( 'WPBookList' ) ) {
				var newUrl = ( window.location.href.substr(0, window.location.href.lastIndexOf( '&' ))) + '&library=' +library;
			} else {
				var newUrl = window.location.href+ '&library=' +library;
			}

			window.history.pushState(null,null,newUrl );

			// Reset offset
			$( '.wpbooklist-admin-tp-top-title' ).attr( 'data-offset', 0 );

			// Initial UI Stuff
			$( '#wpbooklist-search-results-info' ).css({ 'opacity': '0' });
			$( '.wpbooklist-edit-book-indiv-div-class' ).animate({ 'opacity': '0.3'}, 500 );
			$( '#wpbooklist-spinner-edit-change-lib' ).animate({ 'opacity': '1'},500 );

			var data = {
				'action': 'wpbooklist_edit_book_switch_lib_action',
				'security': wpbooklistPhpVariables.adminnonce12,
				'library': library
			};
			console.log( data );

			var request = $.ajax({
				url: ajaxurl,
				type: 'POST',
				data: data,
				timeout: 0,
				success: function( response ) {

					response = response.split( '_Separator_' );
					$( '#wpbooklist-spinner-edit-change-lib' ).animate({ 'opacity': '1'},500 );

					// Clear existing books and replace with the response
					$( '.wpbooklist-admin-tp-inner-container' ).html( '' );
					$( '.wpbooklist-admin-tp-inner-container' ).html( response[0]);
					$( '#wpbooklist-editbook-select-library' ).val( response[1]);
				},
				error: function( jqXHR, textStatus, errorThrown ) {
					console.log( errorThrown );
					console.log( textStatus );
					console.log( jqXHR );
				}
			});

			event.preventDefault ? event.preventDefault() : event.returnValue = false;
		});
	}

	// Function for searching for a title to edit.
	function wpbooklistEditBookSearch() {
		$( document ).on( 'click', '#wpbooklist-edit-book-search-button', function( event ) {

					// Initial UI Stuff
					$( '#wpbooklist-search-results-info' ).css({ 'opacity': '0' });
					$( '.wpbooklist-edit-book-indiv-div-class' ).animate({ 'opacity': '0.3'}, 500 );
					$( '#wpbooklist-spinner-edit-change-lib' ).animate({ 'opacity': '1'},500 );

					var searchTerm = $( '#wpbooklist-edit-book-search-input' ).val();
					var authorCheck = $( '#wpbooklist-search-author-checkbox' ).prop( 'checked' );
					var titleCheck = $( '#wpbooklist-search-title-checkbox' ).prop( 'checked' );
					var library =  $( '#wpbooklist-editbook-select-library' ).val();

					var data = {
						'action': 'wpbooklist_edit_book_search_action',
						'security': wpbooklistPhpVariables.adminnonce13,
						'searchTerm': searchTerm,
						'authorCheck': authorCheck,
						'titleCheck': titleCheck,
						'library': library
					};
					console.log( data );

					var request = $.ajax({
						url: ajaxurl,
						type: 'POST',
						data: data,
						timeout: 0,
						success: function( response ) {
						response = response.split( '_Separator_' );
						$( '#wpbooklist-spinner-edit-change-lib' ).animate({ 'opacity': '1'},500 );

						// Clear existing books and replace with the response
						$( '.wpbooklist-admin-tp-inner-container' ).html( '' );
						$( '.wpbooklist-admin-tp-inner-container' ).html( response[0]);
						$( '#wpbooklist-editbook-select-library' ).val( response[1]);

						// UI Stuff
						var library = $( '#wpbooklist-editbook-select-library' ).children( 'option: selected' ).text();
						if ( library == 'Default Library' ) {
							library = 'Default';
						}

						if ( response[2] == 1 || response[2] == '1' ) {
							var responseText = '<span class="wpbooklist-color-orange-italic">' + response[2] + ' Result</span> Found from the ' +library+ ' Library';
						} else {
							var responseText = '<span class="wpbooklist-color-orange-italic">' + response[2] + ' Results</span> Found from the ' +library+ ' Library';
						}

						$( '#wpbooklist-search-results-info' ).html( responseText );
						$( '#wpbooklist-search-results-info' ).css({ 'opacity': '1' });
						},
						error: function( jqXHR, textStatus, errorThrown ) {
							console.log( errorThrown );
							console.log( textStatus );
							console.log( jqXHR );
						}
					});

					event.preventDefault ? event.preventDefault() : event.returnValue = false;
				});
	}

	// Function that handles the actual editing of a book.
	function wpbooklistEditBookActual() {

				$( document ).on( 'click', '#wpbooklist-admin-editbook-button', function( event ) {
					var successDiv = $( '#wpbooklist-editbook-success-div' );
					successDiv.html( '' );
					$( '#wpbooklist-editbook-signed-first-table' ).animate({ 'margin-bottom': '40px'}, 500 );
					$( '#wpbooklist-success-view-post' ).animate({ 'opacity': '0'}, 500 );

				wpbooklist_add_book_validator();
				var error = $( '#wpbooklist-add-book-error-check' ).attr( 'data-add-book-form-error' );

				var woocommerce = false;
				var woofile = '';
				var amazonAuthYes = $( "input[name='authorize-amazon-yes']" ).prop( 'checked' );
					var library = $( '#wpbooklist-editbook-select-library' ).val();
					var useAmazonYes = $( "input[name='use-amazon-yes']" ).prop( 'checked' );
					var isbn = $( "input[name='book-isbn']" ).val();
					var title = $( "input[name='book-title']" ).val();
					var author = $( "input[name='book-author']" ).val();
					var authorUrl = $( "input[name='book-sale-author-link']" ).val();
					var category = $( "input[name='book-category']" ).val();
					var price = $( "input[name='book-price']" ).val();
					var pages = $( "input[name='book-pages']" ).val();
					var pubYear = $( "input[name='book-pubdate']" ).val();
					var publisher = $( "input[name='book-publisher']" ).val();
					var description = $( "textarea[name='book-description']" ).val();
					var subject = $( "input[name='book-subject']" ).val();
					var country = $( "input[name='book-country']" ).val();
					var notes = $( "textarea[name='book-notes']" ).val();
					var rating = $( '#wpbooklist-editbook-rating' ).val();
					var image = $( "input[name='book-image']" ).val();
					var finished = $( "input[name='book-finished-yes']" ).prop( 'checked' );
					var dateFinished = $( "input[name='book-date-finished-text']" ).val();
					var signed = $( "input[name='book-signed-yes']" ).prop( 'checked' );
					var firstEdition = $( "input[name='book-firstedition-yes']" ).prop( 'checked' );
					var pageYes = $( "input[name='book-indiv-page-yes']" ).prop( 'checked' );
					var postYes = $( "input[name='book-indiv-post-yes']" ).prop( 'checked' );
					var lendable = $( "input[name='book-bookswapper-yes']" ).prop( 'checked' );
					var copies = $( '#wpbooklist-bookswapper-copies' ).val();
					var woocommerce = $( "input[name='book-woocommerce-yes']" ).prop( 'checked' );
					var salePrice = $( "input[name='book-woo-sale-price']" ).val();
					var regularPrice = $( "input[name='book-woo-regular-price']" ).val();
					var stock = $( "input[name='book-woo-stock']" ).val();
					var length = $( "input[name='book-woo-length']" ).val();
					var width = $( "input[name='book-woo-width']" ).val();
					var height = $( "input[name='book-woo-height']" ).val();
					var weight = $( "input[name='book-woo-weight']" ).val();
					var sku = $( '#wpbooklist-addbook-woo-sku' ).val();
					var virtual = $( "input[name='wpbooklist-woocommerce-vert-yes']" ).prop( 'checked' );
					var download = $( "input[name='wpbooklist-woocommerce-download-yes']" ).prop( 'checked' );
					var woofile = $( '#wpbooklist-storefront-preview-img-1' ).attr( 'data-id' );
					var salebegin = $( '#wpbooklist-addbook-woo-salebegin' ).val();
					var saleend = $( '#wpbooklist-addbook-woo-saleend' ).val();
					var purchasenote = $( '#wpbooklist-editbook-woo-note' ).val();
					var productcategory = $( '#wpbooklist-woocommerce-category-select' ).val();
					var reviews = $( '#wpbooklist-woocommerce-review-yes' ).val();
					var upsells = $( '#select2-upsells' ).val();
					var crosssells = $( '#select2-crosssells' ).val();
					var amazonbuylink = $( "input[name='amazon-purchase-link']" ).val();
					var bnbuylink = $( "input[name='bn-link']" ).val();
					var googlebuylink = $( "input[name='google-purchase-link']" ).val();
					var itunesbuylink = $( "input[name='itunes-link']" ).val();
					var booksamillionbuylink = $( "input[name='booksamillion-purchase-link']" ).val();
					var kobobuylink = $( "input[name='kobo-link']" ).val();


					var upsellString = '';
					var crosssellString = '';

					// Making checks to see if Storefront extension is active
					if ( upsells != undefined ) {
						for ( var i = 0; i < upsells.length; i++ ) {
							upsellString = upsellString + ', ' + upsells[i];
						};
					}

					if ( crosssells != undefined ) {
						for ( var i = 0; i < crosssells.length; i++ ) {
							crosssellString = crosssellString + ', ' + crosssells[i];
						};
					}

					if ( salebegin != undefined && saleend != undefined ) {
						// Flipping the sale date start
						if ( salebegin.indexOf( '-' ) ) {
							var finishedtemp = salebegin.split( '-' );
							salebegin = finishedtemp[0] + '-' + finishedtemp[1] + '-' + finishedtemp[2]
						}

						// Flipping the sale date end
						if ( saleend.indexOf( '-' ) ) {
							var finishedtemp = saleend.split( '-' );
							saleend = finishedtemp[0] + '-' + finishedtemp[1] + '-' + finishedtemp[2]
						}	
					}


					if ( lendable == true && copies == 0 ) {
						copies = 1;
					}

					// Flipping the date
					if ( dateFinished.indexOf( '-' ) ) {
						var finishedtemp = dateFinished.split( '-' );
						var dateFinished = finishedtemp[1] + '-' + finishedtemp[2] + '-' + finishedtemp[0]
					}

					var pageId = $( '#wpbooklist-editbook-page-yes' ).attr( 'data-page-id' );
					var postId = $( '#wpbooklist-editbook-post-yes' ).attr( 'data-post-id' );
					var bookId = $( this ).attr( 'data-book-id' );
					var bookUid = $( this ).attr( 'data-book-uid' );

				if ( error === 'false' ) {
					// Show working spinner
					$( '#wpbooklist-spinner-edit-indiv' ).animate({ 'opacity': '1'}, 500 );
					
					var data = {
							'action': 'wpbooklist_edit_book_actual_action',
							'security': wpbooklistPhpVariables.adminnonce14,
							'amazonAuthYes': amazonAuthYes,
							'library': library,
							'useAmazonYes': useAmazonYes,
							'isbn': isbn,
							'title': title,
							'author': author,
							'authorUrl': authorUrl,
							'category': category,
							'price': price,
							'pages': pages,
							'pubYear': pubYear,
							'publisher': publisher,
							'description': description,
							'subject': subject,
							'country': country,
							'notes': notes,
							'rating': rating,
							'image': image,
							'finished': finished,
							'dateFinished': dateFinished,
							'signed': signed,
							'firstEdition': firstEdition,
							'pageYes': pageYes,
							'postYes': postYes,
							'lendable': lendable,
							'copies': copies,
							'pageId': pageId,
							'postId': postId,
							'bookId': bookId,
							'bookUid': bookUid,
							'woocommerce': woocommerce,
							'saleprice': salePrice,
							'regularprice': regularPrice,
							'stock': stock,
							'length': length,
							'width': width,
							'height': height,
							'weight': weight,
							'sku': sku,
							'virtual': virtual,
							'download': download,
							'woofile': woofile,
							'salebegin': salebegin,
							'saleend': saleend,
							'purchasenote': purchasenote,
							'productcategory': productcategory,
							'reviews': reviews,
							'upsells': upsellString,
							'crosssells': crosssellString,
							'amazonbuylink': amazonbuylink,
							'bnbuylink': bnbuylink,
							'googlebuylink':googlebuylink,
							'itunesbuylink': itunesbuylink,
							'booksamillionbuylink': booksamillionbuylink,
							'kobobuylink':kobobuylink
						};
						console.log( data );

						var request = $.ajax({
							url: ajaxurl,
							type: 'POST',
							data: data,
							timeout: 0,
							success: function( response ) {

							response = response.split( '--sep--' );
								
							if ( response[0] == 1 ) {

								var apicallreport = response[8];
								var whichapifound = JSON.parse( response[9]);
								var amazontransient = response[10];

								console.log( apicallreport )
								console.log( 'Here\'s the report for where the this book\'s data was obtained from: ' );
								console.log( whichapifound )

								var amazonapifailcount = response[10];
								console.log( 'The Amazon Fail Count was: ' + amazonapifailcount );
								console.log( 'Did we use an Amazon Transient? ' + amazontransient );



								


								if ( useAmazonYes ) {
									if ( amazonapifailcount == 2 || amazonapifailcount == '2' ) {
										var editbookSuccess1 = '<p><span id="wpbooklist-add-book-success-span">' + wpbooklistPhpVariables.trans49 + '</span><br/> ' + wpbooklistPhpVariables.trans87 + "<em> " + wpbooklistPhpVariables.trans51 + ' </em>' + wpbooklistPhpVariables.trans52;
									} else {
										var editbookSuccess1 = '<p><span id="wpbooklist-add-book-success-span">' + wpbooklistPhpVariables.trans38 + "</span><br/>&nbsp;" + wpbooklistPhpVariables.trans83 + ":&nbsp;<span id='wpbooklist-editbook-success-shortcode'>"; 
									}
								} else {
									var editbookSuccess1 = '<p><span id="wpbooklist-add-book-success-span">' + wpbooklistPhpVariables.trans38 + "</span><br/>&nbsp;" + wpbooklistPhpVariables.trans83 + "&nbsp;<span id='wpbooklist-editbook-success-shortcode'>"; 
								}




								
								if ( library == response[7] + 'wpbooklist_jre_saved_book_log' ) {
									var shortcode = '[wpbooklist_shortcode]'
								} else {
									library = library.split( '_' );
									library = library[library.length-1];
									var shortcode = '[wpbooklist_shortcode table="' +library+ '"]'
								}
								
								var editbookSuccess2 = shortcode + '</span></p><a id="wpbooklist-success-1" class="wpbooklist-show-book-colorbox">' + wpbooklistPhpVariables.trans84 + '</a>';


									if ( useAmazonYes ) {
									if ( amazonapifailcount == 2 || amazonapifailcount == '2' ) {
										var editbookSuccess2 = '</span></p><a id="wpbooklist-success-1" class="wpbooklist-show-book-colorbox">' + wpbooklistPhpVariables.trans84 + '</a>';
									} else {
										var editbookSuccess2 = shortcode + '</span></p><a id="wpbooklist-success-1" class="wpbooklist-show-book-colorbox">' + wpbooklistPhpVariables.trans84 + '</a>';
									}
								} else {
									var editbookSuccess2 = shortcode + '</span></p><a id="wpbooklist-success-1" class="wpbooklist-show-book-colorbox">' + wpbooklistPhpVariables.trans84 + '</a>';
								}

								var editbookSuccess3 = '';

								// If book addition was succesful and user chose to create a post
								if ( response[4] == 'true' && response[3] == 'false' ) {
									var editbookSuccess3 = "<p id='wpbooklist-editbook-success-post-p'><a href='" + response[6] + '">' + wpbooklistPhpVariables.trans + '</a></p></div>';
									$( '#wpbooklist-editbook-signed-first-table' ).animate({ 'margin-bottom': '70px'}, 500 );
									$( '#wpbooklist-success-view-post' ).animate({ 'opacity': '1'}, 500 );
								} 

								// If book addition was succesful and user chose to create a page
								if ( response[3] == 'true' && response[4] == 'false' ) {
									var editbookSuccess3 = "<p id='wpbooklist-editbook-success-page-p'><a href='" + response[5] + '">' + wpbooklistPhpVariables.trans42 + '</a></p></div>';
									$( '#wpbooklist-editbook-signed-first-table' ).animate({ 'margin-bottom': '70px'}, 500 );
									$( '#wpbooklist-success-view-page' ).animate({ 'opacity': '1'}, 500 );
								} 

								// If book addition was succesful and user chose to create a post and a page
								if ( response[3] == 'true' && response[4] == 'true' ) {
									var editbookSuccess3 = "<p id='wpbooklist-editbook-success-page-p'><a href='" + response[5] + '">' + wpbooklistPhpVariables.trans42 + "</a></p><p id='wpbooklist-editbook-success-post-p'><a href='" + response[6] + '">' + wpbooklistPhpVariables.trans41 + '</a></p></div>';
									$( '#wpbooklist-editbook-signed-first-table' ).animate({ 'margin-bottom': '100px'}, 500 );
									$( '#wpbooklist-success-view-page' ).animate({ 'opacity': '1'}, 500 );
									$( '#wpbooklist-success-view-post' ).animate({ 'opacity': '1'}, 500 );
								} 

								// Add response message to DOM
								var endMessage = '<div id="wpbooklist-editbook-success-thanks">' + wpbooklistPhpVariables.trans43 + ' <a href="http://wpbooklist.com/index.php/extensions/">' + wpbooklistPhpVariables.trans44 + '</a><br/><br/> ' + wpbooklistPhpVariables.trans45 + ' <a id="wpbooklist-editbook-success-review-link" href="https://wordpress.org/support/plugin/wpbooklist/reviews/?filter=5" >' + wpbooklistPhpVariables.trans46 + '</a><img id="wpbooklist-smile-icon-1" src="' + wpbooklistPhpVariables.ROOT_IMG_ICONS_URL + 'happy.svg"></div>';
								successDiv.html( editbookSuccess1 + editbookSuccess2 + editbookSuccess3+ endMessage );

								$( '#wpbooklist-spinner-edit-indiv' ).animate({ 'opacity': '0'}, 500 );
								$( '#wpbooklist-success-1' ).animate({ 'opacity': '1'}, 500 );
								$( '#wpbooklist-success-1' ).attr( 'data-bookid', response[1]);
								$( '#wpbooklist-success-1' ).attr( 'data-booktable', response[2]);
							} else {
								$( '#wpbooklist-editbook-signed-first-table' ).animate({ 'margin-bottom': '65px'}, 500 );
								$( '#wpbooklist-success-1' ).html( wpbooklistPhpVariables.trans86);
								$( '#wpbooklist-spinner-edit-indiv' ).animate({ 'opacity': '0'}, 500 );
								$( '#wpbooklist-success-1' ).animate({ 'opacity': '1'}, 500 );
							}
							},
							error: function( jqXHR, textStatus, errorThrown ) {
								$( '#wpbooklist-success-1' ).html( wpbooklistPhpVariables.trans86);
							$( '#wpbooklist-spinner-edit-indiv' ).animate({ 'opacity': '0'}, 500 );
							$( '#wpbooklist-success-1' ).animate({ 'opacity': '1'}, 500 );
								console.log( errorThrown );
								console.log( textStatus );
								console.log( jqXHR );
								
							}
						});
					}
				});
	}




	// For deleting a book.
	function wpbooklistDeleteBook() {
		$( document ).on( 'click', '.wpbooklist-edit-actions-delete-button', function( event ) {

					// UI Stuff
					var key = $( this ).attr( 'data-key' );
					$( '#wpbooklist-spinner-' +key).animate({ 'opacity': '1' });

					var deleteString = '';
					// Grabbing the post and page ID's, if they exist
					$( this ).parent().find( 'input' ).each( function( index) {
						if ( $( this ).attr( 'data-id' ) != undefined && $( this ).attr( 'data-id' ) != null ) {
							deleteString = deleteString + '-' +$( this ).attr( 'data-id' );
						}
					});

					var bookId = $( this ).attr( 'data-book-id' );
					var library = $( '#wpbooklist-editbook-select-library' ).val();

					var data = {
						'action': 'wpbooklist_delete_book_action',
						'security': wpbooklistPhpVariables.adminnonce15,
						'deleteString': deleteString,
						'bookId': bookId,
						'library': library

					};
					console.log( data );

					var request = $.ajax({
						url: ajaxurl,
						type: 'POST',
						data: data,
						timeout: 0,
						success: function( response ) {
						response = response.split( '-' );
						console.log( response );
						var resultString = '';
						if ( response[0] == 1 ) {
							resultString = '<span class="wpbooklist-color-orange-italic">' + wpbooklistPhpVariables.trans88 + '</span><img id="wpbooklist-smile-icon-1" src="' + wpbooklistPhpVariables.ROOT_IMG_ICONS_URL + 'happy.svg"><br/>';

							$( '#wpbooklist-delete-result-' +key).html( resultString);

							setTimeout( function() {
								document.location.reload( true );
							}, 2000 )
						}

						},
						error: function( jqXHR, textStatus, errorThrown ) {
							console.log( errorThrown );
							console.log( textStatus );
							console.log( jqXHR );
						}
					});

					event.preventDefault ? event.preventDefault() : event.returnValue = false;
				});
	}


	// Function for saving user's API info.
	function wpbooklistUserApis() {
		$( '#wpbooklist-save-api-settings' ).click( function( event ) {

					var amazonapipublic = $( '#wpbooklist-amazon-api-public' ).val();
					var amazonapisecret = $( '#wpbooklist-amazon-api-secret' ).val();
					var googleapi = $( '#wpbooklist-google-api' ).val();

					var data = {
						'amazonapipublic': amazonapipublic,
						'amazonapisecret': amazonapisecret,
						'googleapi':googleapi,
						'action': 'wpbooklist_user_apis_action',
						'security': wpbooklistPhpVariables.adminnonce16,
					};
					console.log( data );

					var request = $.ajax({
						url: ajaxurl,
						type: 'POST',
						data: data,
						timeout: 0,
						success: function( response ) {
						document.location.reload( true );
						},
						error: function( jqXHR, textStatus, errorThrown ) {
							console.log( errorThrown );
							console.log( textStatus );
							console.log( jqXHR );
						}
					});

					event.preventDefault ? event.preventDefault() : event.returnValue = false;
				});
	}

	












	// For uploading a new StylePak after purchase.
	function wpbooklistUploadNewStylepak() {		
				// For uploading a new StylePak
				$( document ).on( 'change', '#wpbooklist-add-new-library-stylepak', function( event ) {

					$( '.wpbooklist-spinner' ).animate({ 'opacity': '1' });

					var files = event.target.files; // FileList object
					var theFile = files[0];
					// Open Our formData Object
					var formData = new FormData();
					formData.append( 'action', 'wpbooklist_upload_new_stylepak_action' );
					formData.append( 'my_uploaded_file', theFile );
					var nonce = wpbooklistPhpVariables.adminnonce17;
					formData.append( 'security', nonce );

					// If it's a zip file or a css file, proceed with uploading the file
					if ( ( theFile.name.includes( '.zip' ) || theFile.name.includes( '.css' ) ) && !theFile.name.includes( 'Template' ) ) {
						jQuery.ajax({
							url: ajaxurl,
							type: 'POST',
							data: formData,
							contentType: false,
							processData: false,
							success: function( response ) {
								console.log( response );
								response = response.split( 'sep' );
								if ( response[2] == 1 ) {
									$( '.wpbooklist-spinner' ).animate({ 'opacity': '0' });
									$( '#wpbooklist-addstylepak-success-div' ).html( "<span id='wpbooklist-add-book-success-span'>" + wpbooklistPhpVariables.trans38 + "</span><br/><br/>" + wpbooklistPhpVariables.trans89 + "<div id='wpbooklist-addstylepak-success-thanks'>" + wpbooklistPhpVariables.trans43 + "&nbsp;<a href='http://wpbooklist.com/index.php/extensions/'>" + wpbooklistPhpVariables.trans44 + "</a><br/><br/>" + wpbooklistPhpVariables.trans45 + "&nbsp;<a id='wpbooklist-addbook-success-review-link' href='https://wordpress.org/support/plugin/wpbooklist/reviews/?filter=5'>" + wpbooklistPhpVariables.trans46 + "</a><img id='wpbooklist-smile-icon-1' src='" + wpbooklistPhpVariables.ROOT_IMG_ICONS_URL + "happy.svg'></div>" );

									$( 'html, body' ).animate({
										scrollTop: $( '#wpbooklist-addstylepak-success-div' ).offset().top-100
									}, 1000 );
								} else {

								}
							},
							error: function( jqXHR, textStatus, errorThrown ) {
								console.log( errorThrown );
								console.log( textStatus );
								console.log( jqXHR );
							}	
						}); 

					} else {
						// If the file isn't a zip or css file...
						$( '.wpbooklist-spinner' ).animate({ 'opacity': '0' });
						$( '#wpbooklist-addstylepak-success-div' ).html( "<span id='wpbooklist-add-book-success-span'>" + wpbooklistPhpVariables.trans90 + "</span><br/><br/>" + wpbooklistPhpVariables.trans91 + " <em>" + wpbooklistPhpVariables.trans92 + "</em> " + wpbooklistPhpVariables.trans93 + "." );

						$( 'html, body' ).animate({
							scrollTop: $( '#wpbooklist-addstylepak-success-div' ).offset().top-100
						}, 1000 );
					}

					//event.preventDefault ? event.preventDefault() : event.returnValue = false;
				});
	}




	// For assigning a StylePak to a library.
	function wpbooklistAssignStylepak() {		
		// Actually assigning a StylePak to a library
				$( document ).on( 'click', '#wpbooklist-apply-library-stylepak', function( event ) {
					var stylePak = $( '#wpbooklist-select-library-stylepak' ).val();
					var library = $( '#wpbooklist-stylepak-select-library' ).val();

					var data = {
					'action': 'wpbooklist_assign_stylepak_action',
					'security': wpbooklistPhpVariables.adminnonce18,
					'stylepak': stylePak,
					'library': library
					};

					console.log( data );

					var request = $.ajax({
						url: ajaxurl,
						type: 'POST',
						data: data,
						timeout: 0,
						success: function( response ) {
						console.log( response );
						document.location.reload();
						},
						error: function( jqXHR, textStatus, errorThrown ) {
							console.log( errorThrown );
							console.log( textStatus );
							console.log( jqXHR );
						}
					});

				});
	}

	// For uploading a new Post Template after purchase.
	function wpbooklistUploadNewPostTemplate() {
		$( document ).on( 'change', '#wpbooklist-add-new-post-template', function( event ) {

					$( '.wpbooklist-spinner' ).animate({ 'opacity': '1' });

					var files = event.target.files; // FileList object
					var theFile = files[0];
					// Open Our formData Object
					var formData = new FormData();
					formData.append( 'action', 'wpbooklist_upload_new_post_template_action' );
					formData.append( 'my_uploaded_file', theFile );
					var nonce = wpbooklistPhpVariables.adminnonce19;
					formData.append( 'security', nonce );

					// If it's a zip file or a css file, proceed with uploading the file
					if ( theFile.name.includes( '.zip' ) || theFile.name.includes( '.php' ) ) {
						jQuery.ajax({
							url: ajaxurl,
							type: 'POST',
							data: formData,
							contentType: false,
							processData: false,
							success: function( response ) {
								console.log( response );
								response = response.split( 'sep' );
								if ( response[2] == 1 ) {
									$( '.wpbooklist-spinner' ).animate({ 'opacity': '0' });
									$( '#wpbooklist-addtemplate-success-div' ).html( "<span id='wpbooklist-add-book-success-span'>" + wpbooklistPhpVariables.trans38 + "</span><br/><br/>" + wpbooklistPhpVariables.trans94 + "<div id='wpbooklist-addstylepak-success-thanks'>" + wpbooklistPhpVariables.trans43 + "&nbsp;<a href='http://wpbooklist.com/index.php/extensions/'>" + wpbooklistPhpVariables.trans44 + "</a><br/><br/>" + wpbooklistPhpVariables.trans45 + "&nbsp;<a id='wpbooklist-addbook-success-review-link' href='https://wordpress.org/support/plugin/wpbooklist/reviews/?filter=5'>" + wpbooklistPhpVariables.trans46 + "</a><img id='wpbooklist-smile-icon-1' src='" + wpbooklistPhpVariables.ROOT_IMG_ICONS_URL + "happy.svg'></div>" );

									$( 'html, body' ).animate({
										scrollTop: $( '#wpbooklist-addtemplate-success-div' ).offset().top-100
									}, 1000 );

								

								} else {

								}
							},
							error: function( jqXHR, textStatus, errorThrown ) {
								console.log( errorThrown );
								console.log( textStatus );
								console.log( jqXHR );
							}	
						}); 

					} else {
						// If the file isn't a zip or css file...
						$( '.wpbooklist-spinner' ).animate({ 'opacity': '0' });
						$( '#wpbooklist-addtemplate-success-div' ).html( "<span id='wpbooklist-add-book-success-span'>" + wpbooklistPhpVariables.trans90 + "</span><br/><br/>" + wpbooklistPhpVariables.trans95 + " <em>" + wpbooklistPhpVariables.trans92 + "</em> " + wpbooklistPhpVariables.trans93 + "." );

						$( 'html, body' ).animate({
							scrollTop: $( '#wpbooklist-addtemplate-success-div' ).offset().top-100
						}, 1000 );
					}

					event.preventDefault ? event.preventDefault() : event.returnValue = false;
				});

	}

	// For assigning a Post Template to a Post.
	function wpbooklistAssignPostTemplate() {
		$( document ).on( 'click', '#wpbooklist-apply-post-template', function( event ) {
					var template = $( '#wpbooklist-select-post-template' ).val();

					var data = {
					'action': 'wpbooklist_assign_post_template_action',
					'security': wpbooklistPhpVariables.adminnonce20,
					'template': template
					};

					console.log( data );

					var request = $.ajax({
						url: ajaxurl,
						type: 'POST',
						data: data,
						timeout: 0,
						success: function( response ) {
						console.log( response );
						document.location.reload();
						},
						error: function( jqXHR, textStatus, errorThrown ) {
							console.log( errorThrown );
							console.log( textStatus );
							console.log( jqXHR );
						}
					});

				});
	}

	// For uploading a new Page Template after purchase.
	function wpbooklistUploadNewPageTemplate() {
		$( document ).on( 'change', '#wpbooklist-add-new-page-template', function( event ) {

					$( '.wpbooklist-spinner' ).animate({ 'opacity': '1' });

					var files = event.target.files; // FileList object
					var theFile = files[0];
					// Open Our formData Object
					var formData = new FormData();
					formData.append( 'action', 'wpbooklist_upload_new_page_template_action' );
					formData.append( 'my_uploaded_file', theFile );
					var nonce = wpbooklistPhpVariables.adminnonce21;
					formData.append( 'security', nonce );

					// If it's a zip file or a css file, proceed with uploading the file
					if ( theFile.name.includes( '.zip' ) || theFile.name.includes( '.php' ) ) {
						jQuery.ajax({
							url: ajaxurl,
							type: 'POST',
							data: formData,
							contentType: false,
							processData: false,
							success: function( response ) {
								console.log( response );
								response = response.split( 'sep' );
								if ( response[2] == 1 ) {
									$( '.wpbooklist-spinner' ).animate({ 'opacity': '0' });
									$( '#wpbooklist-addtemplate-success-div' ).html( "<span id='wpbooklist-add-book-success-span'>" + wpbooklistPhpVariables.trans38 + "</span><br/><br/>" + wpbooklistPhpVariables.trans94 + "<div id='wpbooklist-addstylepak-success-thanks'>" + wpbooklistPhpVariables.trans43 + "&nbsp;<a href='http://wpbooklist.com/index.php/extensions/'>" + wpbooklistPhpVariables.trans44 + "</a><br/><br/>" + wpbooklistPhpVariables.trans45 + "&nbsp;<a id='wpbooklist-addbook-success-review-link' href='https://wordpress.org/support/plugin/wpbooklist/reviews/?filter=5'>" + wpbooklistPhpVariables.trans46 + "</a><img id='wpbooklist-smile-icon-1' src='" + wpbooklistPhpVariables.ROOT_IMG_ICONS_URL + "happy.svg'></div>" );

									$( 'html, body' ).animate({
										scrollTop: $( '#wpbooklist-addtemplate-success-div' ).offset().top-100
									}, 1000 );

								

								} else {

								}
							},
							error: function( jqXHR, textStatus, errorThrown ) {
								console.log( errorThrown );
								console.log( textStatus );
								console.log( jqXHR );
							}	
						}); 

					} else {
						// If the file isn't a zip or css file...
						$( '.wpbooklist-spinner' ).animate({ 'opacity': '0' });
						$( '#wpbooklist-addtemplate-success-div' ).html( "<span id='wpbooklist-add-book-success-span'>" + wpbooklistPhpVariables.trans90 + "</span><br/><br/>" + wpbooklistPhpVariables.trans95 + " <em>" + wpbooklistPhpVariables.trans92 + "</em> " + wpbooklistPhpVariables.trans93 + "." );

						$( 'html, body' ).animate({
							scrollTop: $( '#wpbooklist-addtemplate-success-div' ).offset().top-100
						}, 1000 );
					}

					event.preventDefault ? event.preventDefault() : event.returnValue = false;
				});
	}

	// For assigning a Page Template to a Page.
	function wpbooklistAssignPageTemplate() {
		$( document ).on( 'click', '#wpbooklist-apply-page-template', function( event ) {
					var template = $( '#wpbooklist-select-page-template' ).val();

					var data = {
					'action': 'wpbooklist_assign_page_template_action',
					'security': wpbooklistPhpVariables.adminnonce22,
					'template': template
					};

					console.log( data );

					var request = $.ajax({
						url: ajaxurl,
						type: 'POST',
						data: data,
						timeout: 0,
						success: function( response ) {
						console.log( response );
						document.location.reload();
						},
						error: function( jqXHR, textStatus, errorThrown ) {
							console.log( errorThrown );
							console.log( textStatus );
							console.log( jqXHR );
						}
					});

				});
	}

	// For creating a DB backup of a Library
	function wpbooklistCreateDbLibraryBackup() {

		$( document ).on( 'click', '#wpbooklist-apply-library-backup', function( event ) {

			$( '#wpbooklist-spinner-backup' ).animate({ 'opacity': '1'}, 500 );

			var library = $( '#wpbooklist-backup-select-library' ).val();

			var data = {
				'action': 'wpbooklist_create_db_library_backup_action',
				'security': wpbooklistPhpVariables.adminnonce23,
				'library': library
			};
			console.log( data );

			var request = $.ajax({
				url: ajaxurl,
				type: 'POST',
				data: data,
				timeout: 0,
				success: function( response ) {
					response = response.split( ', ' );
					if ( response[0] == '1' ) {
					$( '#wpbooklist-spinner-backup' ).animate({ 'opacity': '0'}, 500 );
					$( '#wpbooklist-addbackup-success-div' ).html( "<span id='wpbooklist-add-book-success-span'>" + wpbooklistPhpVariables.trans38 + "</span><br/><br/> " + wpbooklistPhpVariables.trans97 + " <a href='" + wpbooklistPhpVariables.LIBRARY_DB_BACKUPS_UPLOAD_URL + response[1] + ".zip'>" + wpbooklistPhpVariables.trans98 + ".</a><div id='wpbooklist-addstylepak-success-thanks'>" + wpbooklistPhpVariables.trans43 + " <a href='http://wpbooklist.com/index.php/extensions/'>" + wpbooklistPhpVariables.trans44 + "</a><br/><br/> " + wpbooklistPhpVariables.trans45 + " <a id='wpbooklist-addbook-success-review-link' href='https://wordpress.org/support/plugin/wpbooklist/reviews/?filter=5'>" + wpbooklistPhpVariables.trans46 + "</a><img id='wpbooklist-smile-icon-1' src='" + wpbooklistPhpVariables.ROOT_IMG_ICONS_URL + "happy.svg'></div>" );

						$( 'html, body' ).animate({
							scrollTop: $( '#wpbooklist-addbackup-success-div' ).offset().top-100
						}, 1000 );

					}
	
				},
				error: function( jqXHR, textStatus, errorThrown ) {
					console.log( errorThrown );
					console.log( textStatus );
					console.log( jqXHR );
				}
			});

			event.preventDefault ? event.preventDefault() : event.returnValue = false;
		});
	}


	// For restoring a backup of a Library
	function wpbooklistRestoreDbLibraryBackup() {
		$( document ).on( 'click', '#wpbooklist-apply-library-restore', function( event ) {

			$( '#wpbooklist-spinner-restore-backup' ).animate({ 'opacity': '1'}, 500 );

			var table = $( '#wpbooklist-select-library-backup' ).val();
			var backup = $( '#wpbooklist-select-actual-backup' ).val();

			var data = {
				'action': 'wpbooklist_restore_db_library_backup_action',
				'security':  wpbooklistPhpVariables.adminnonce24,
				'table': table,
				'backup': backup
			};
			console.log( data );

			var request = $.ajax({
				url: ajaxurl,
				type: 'POST',
				data: data,
				timeout: 0,
				success: function( response ) {
					$( '#wpbooklist-spinner-restore-backup' ).animate({ 'opacity': '0'}, 500 );
					$( '#wpbooklist-addbackup-success-div' ).html( "<span id='wpbooklist-add-book-success-span'>" + wpbooklistPhpVariables.trans38 + "</span><br/><br/> " + wpbooklistPhpVariables.trans99 + "<div id='wpbooklist-addstylepak-success-thanks'>" + wpbooklistPhpVariables.trans43 + " <a href='http://wpbooklist.com/index.php/extensions/'>" + wpbooklistPhpVariables.trans44 + "</a><br/><br/> " + wpbooklistPhpVariables.trans45 + " <a id='wpbooklist-addbook-success-review-link' href='https://wordpress.org/support/plugin/wpbooklist/reviews/?filter=5'>" + wpbooklistPhpVariables.trans46 + "</a><img id='wpbooklist-smile-icon-1' src='" + wpbooklistPhpVariables.ROOT_IMG_ICONS_URL + "happy.svg'></div>" );

					$( 'html, body' ).animate({
						scrollTop: $( '#wpbooklist-addbackup-success-div' ).offset().top-100
					}, 1000 );
				console.log( response );
				},
				error: function( jqXHR, textStatus, errorThrown ) {
					console.log( errorThrown );
					console.log( textStatus );
					console.log( jqXHR );
				}
			});

			event.preventDefault ? event.preventDefault() : event.returnValue = false;
		});
	}


	// For creating a .csv file of ISBN/ASIN numbers
	function wpbooklistCreateCsv() {
		$( document ).on( 'click', '#wpbooklist-apply-library-backup-csv', function( event ) {

					$( '#wpbooklist-spinner-backup-csv' ).animate({ 'opacity': '1'}, 500 );

					var table = $( '#wpbooklist-backup-csv-select-library' ).val();

					var data = {
						'action': 'wpbooklist_create_csv_action',
						'security':  wpbooklistPhpVariables.adminnonce25,
						'table': table
					};

					var request = $.ajax({
						url: ajaxurl,
						type: 'POST',
						data: data,
						timeout: 0,
						success: function( response ) {
						response = response.split( ', ' );
						if ( response[0] == '1' ) {
							$( '#wpbooklist-spinner-backup-csv' ).animate({ 'opacity': '0'}, 500 );
							$( '#wpbooklist-addbackup-success-div' ).html( "<span id='wpbooklist-add-book-success-span'>" + wpbooklistPhpVariables.trans38 + "</span><br/><br/> " + wpbooklistPhpVariables.trans100 + " <a href='" + wpbooklistPhpVariables.LIBRARY_DB_BACKUPS_UPLOAD_URL + response[1] + ".zip'>" + wpbooklistPhpVariables.trans101 + ".</a> " + wpbooklistPhpVariables.trans102 + " <a href='https://wpbooklist.com/index.php/downloads/bulk-upload-extension/'>" + wpbooklistPhpVariables.trans69 + "</a> <div id='wpbooklist-addstylepak-success-thanks'>" + wpbooklistPhpVariables.trans43 + " <a href='http://wpbooklist.com/index.php/extensions/'>" + wpbooklistPhpVariables.trans44 + "</a><br/><br/> " + wpbooklistPhpVariables.trans45 + " <a id='wpbooklist-addbook-success-review-link' href='https://wordpress.org/support/plugin/wpbooklist/reviews/?filter=5'>" + wpbooklistPhpVariables.trans46 + "</a><img id='wpbooklist-smile-icon-1' src='" + wpbooklistPhpVariables.ROOT_IMG_ICONS_URL + "happy.svg'></div>" );

								$( 'html, body' ).animate({
									scrollTop: $( '#wpbooklist-addbackup-success-div' ).offset().top-100
								}, 1000 );
							console.log( 'success!)' );
						}
						},
						error: function( jqXHR, textStatus, errorThrown ) {
							console.log( errorThrown );
							console.log( textStatus );
							console.log( jqXHR );
						}
					});

					event.preventDefault ? event.preventDefault() : event.returnValue = false;
				});
	}

	// For setting the Amazon Localization.
	function wpbooklistAmazonLocalization() {
		$( document ).on( 'click', '#wpbooklist-save-localization', function( event ) {

					var country;
					var boxes = jQuery( '.wpbooklist-localization-checkbox' );
					for ( var i=0; i<boxes.length; i++ ) {
						if ( boxes[i].checked ) {
						country = boxes[i].value;
						}
					}

					var data = {
						'action': 'wpbooklist_amazon_localization_action',
						'security': wpbooklistPhpVariables.adminnonce26,
						'country': country
					};
					console.log( data );

					var request = $.ajax({
						url: ajaxurl,
						type: 'POST',
						data: data,
						timeout: 0,
						success: function( response ) {
						document.location.reload();
						},
						error: function( jqXHR, textStatus, errorThrown ) {
							console.log( errorThrown );
							console.log( textStatus );
							console.log( jqXHR );
						}
					});

					event.preventDefault ? event.preventDefault() : event.returnValue = false;
				});
	}

	// For deleting all books in library.
	function wpbooklistDeleteAllBooksInLibrary() {
		// For deleting all books in library
		$( document ).on( 'click', '#wpbooklist-bulk-edit-mode-delete-all-in-lib', function( event ) {

			$( '#wpbooklist-spinner-edit-change-lib' ).animate({ 'opacity': '1'}, 500 );

			var library = $( '#wpbooklist-editbook-select-library' ).val();

			var data = {
				'action': 'wpbooklist_delete_all_books_in_library_action',
				'security': wpbooklistPhpVariables.adminnonce27,
				'library': library,
				'deleteallbooks': true
			};

			var request = $.ajax({
				url: ajaxurl,
				type: 'POST',
				data: data,
				timeout: 0,
				success: function( response ) {

					if ( -1 < window.location.href.indexOf( '&library' ) ) {
					var url = window.location.href.split( '&' );
					url = url[0] + '&' + url[1];
					} else {
					var url = window.location.href
					}

					window.location.href = url;


				},
				error: function( jqXHR, textStatus, errorThrown ) {
					console.log( errorThrown );
					console.log( textStatus );
					console.log( jqXHR );
				}
			});

		});
	}


	// For deleting all books, pages, and posts in library.
	function wpbooklistDeleteAllBooksPagesAndPosts() {
		// For deleting all books, pages, and posts in library
				$( document ).on( 'click', '#wpbooklist-bulk-edit-mode-delete-all-plus-pp-in-lib', function( event ) {

					$( '#wpbooklist-spinner-edit-change-lib' ).animate({ 'opacity': '1'}, 500 );

					var library = $( '#wpbooklist-editbook-select-library' ).val();

					var data = {
						'action': 'wpbooklist_delete_all_books_pages_and_posts_action',
						'security': wpbooklistPhpVariables.adminnonce28,
						'library': library,
						'deleteallbooksandpostandpages': true
					};

					var request = $.ajax({
						url: ajaxurl,
						type: 'POST',
						data: data,
						timeout: 0,
						success: function( response ) {
						if ( -1 < window.location.href.indexOf( '&library' ) ) {
							var url = window.location.href.split( '&' );
							url = url[0] + '&' + url[1];
						} else {
							var url = window.location.href
						}

						window.location.href = url;
						},
						error: function( jqXHR, textStatus, errorThrown ) {
							console.log( errorThrown );
							console.log( textStatus );
							console.log( jqXHR );
						}
					});

				});

	}

	// For deleting all checked books
	function wpbooklistDeleteAllCheckedBooks() {

		// For deleting all titles that are checked
				$( document ).on( 'click', '#wpbooklist-bulk-edit-mode-delete-checked', function( event ) {

					$( '#wpbooklist-spinner-edit-change-lib' ).animate({ 'opacity': '1'}, 500 );

					var bookId = '';
					var library = '';
					var deleteString = '';
					$( '.wpbooklist-bulk-delete-checkbox' ).each( function() {
						if ( $( this ).prop( 'checked' ) == true ) {
							bookId = bookId+ 'sep' +$( this ).attr( 'data-book-id' );

							// Grabbing the post and page ID's, if they exist
							$( this ).parent().parent().parent().find( '.wpbooklist-edit-actions-div .wpbooklist-edit-book-delete-page-post-div input' ).each( function( index) {
								if ( $( this ).prop( 'checked' ) ) {
									if ( $( this ).attr( 'data-id' ) != undefined && $( this ).attr( 'data-id' ) != null ) {
										deleteString = deleteString + '-' +$( this ).attr( 'data-id' );
									}
								}
							});

							deleteString = deleteString + 'sep';

						}
					});

					var library = $( '#wpbooklist-editbook-select-library' ).val();

					var data = {
						'action': 'wpbooklist_delete_all_checked_books_action',
						'security': wpbooklistPhpVariables.adminnonce29,
						'deleteString': deleteString,
						'bookId': bookId,
						'library': library,
						'deletechecked': true
					};

					var request = $.ajax({
						url: ajaxurl,
						type: 'POST',
						data: data,
						timeout: 0,
						success: function( response ) {
						document.location.reload();
						console.log( response );
						},
						error: function( jqXHR, textStatus, errorThrown ) {
							console.log( errorThrown );
							console.log( textStatus );
							console.log( jqXHR );
						}
					});

					event.preventDefault ? event.preventDefault() : event.returnValue = false;
				});

		}


		// For dismissing the admin notice forever
		function wpbooklistDismissPremNoticeForever() {
			$( document ).on( 'click', '.wpbooklist-my-notice-dismiss-forever', function( event ) {

				var id = $( this ).attr( 'id' );

				var data = {
				'action': 'wpbooklist_jre_dismiss_prem_notice_forever_action',
				'security': wpbooklistPhpVariables.adminnonce30,
				'id': id,
				};

				var request = $.ajax({
					url: ajaxurl,
					type: 'POST',
					data: data,
					timeout: 0,
					success: function( response ) {
					document.location.reload();
					},
					error: function( jqXHR, textStatus, errorThrown ) {
						console.log( errorThrown );
						console.log( textStatus );
						console.log( jqXHR );
					}
				});
		  });
		}

		// For re-ordering books on the 'Edit & Delete Books' tab.
		function wpbooklistReorderBooks() {
			var book;
				var origNode;
				var mousedown = false;
				var direction = "";
				var oldx = 0


				// Determining if user is scrolling
				window.isScrolling = false;
				$( window).scroll( function() {
					window.isScrolling = true;
					clearTimeout( $.data( this, 'scrollTimer' ));
					$.data( this, 'scrollTimer', setTimeout( function() {
						// If the window didn't scroll for 250ms
						window.isScrolling = false;
					}, 500 ));
				});

				// disable mousewheel
				function wpbookliststopmousewheel() {
					if (mousedown == true ) {
					return false;
					}
				}

				$( document ).mousemove( wpbooklistmousemove );

				$( document ).on( 'mouseup', function( e ) {
					// If Reorder mode is active...
					console.log( $( '#wpbooklist-reorder-button' ).attr( 'disabled' ));
					if ( $( '#wpbooklist-reorder-button' ).attr( 'disabled' ) == 'disabled' ) {

						$( document ).unbind( 'mouseenter', wpbooklistmouseenter);
						$( document ).unbind( 'mousedown', wpbooklistmousedown );
						$( document ).unbind( 'mousemove', wpbooklistmousemove );
						$( document ).unbind( 'mousemove', wpbooklistmousemove );
						$( document ).unbind( 'onmousewheel', wpbookliststopmousewheel );

						$( '#clone' ).remove();
						$( '#book-in-movement .wpbooklist-spinner' ).animate({ 'opacity': '1' });
						
						// Get the ids of books
						var idarray = [];
						$( '.wpbooklist-edit-book-indiv-div-class .wpbooklist-edit-title-div .wpbooklist-edit-img-author-div .wpbooklist-edit-book-cover-img' ).each( function() {
							var id = $( this ).attr( 'data-bookuid' );
							idarray.push( id );
						});

						var idarray = JSON.stringify( idarray);
						var table = $( '#wpbooklist-editbook-select-library' ).val();

						var data = {
							'action': 'wpbooklist_reorder_action',
							'security': wpbooklistPhpVariables.adminnonce31,
							'idarray': idarray,
							'table': table
						};
						console.log( data );

						var request = $.ajax({
							url: ajaxurl,
							type: 'POST',
							data: data,
							timeout: 0,
							success: function( response ) {
							//if ( response == 1 ) {
								console.log( response );
								mousedown = false;
									$( '.wpbooklist-search-indiv-container-reorder' ).css({ 'pointer-events': 'all' });
									$( '#book-in-movement .wpbooklist-spinner' ).animate({ 'opacity': '0' });
									$( '.wpbooklist-edit-book-indiv-div-class' ).css({ 'opacity': '1' });
									$( '.wpbooklist-edit-book-title, .wpbooklist-edit-book-cover-img, .wpbooklist-edit-book-icon, .wpbooklist-edit-book-author' ).css({ 'pointer-events': 'all', 'opacity': '1' });
									$( '.wpbooklist-edit-book-indiv-div-class' ).css({ 'border': '1px solid #e5e5e5', 'pointer-events': 'all' });
									$( '.wpbooklist-edit-actions-div' ).css({ 'opacity': '0.3' });
									$( '#book-in-movement' ).removeAttr( 'id' );

									// re-bind events
									$( document ).mousemove( wpbooklistmousemove );
									$( document ).on( 'mousedown', '.wpbooklist-search-indiv-container-reorder', wpbooklistmousedown )
									$( document ).mousemove( wpbooklistmousemove );
									$( document ).on( 'mouseenter', '.wpbooklist-search-indiv-container-reorder', wpbooklistmouseenter);
								//}
							},
							error: function( jqXHR, textStatus, errorThrown ) {
								console.log( errorThrown );
								console.log( textStatus );
								console.log( jqXHR );
							}
						});

						}
				});


				document.addEventListener( 'mousemove', wpbooklistmousemove );

				function wpbooklistmousedown() {
					mousedown = true;
					document.onmousewheel = wpbookliststopmousewheel;

					if ( $( '#wpbooklist-reorder-button' ).attr( 'disabled' ) == 'disabled' ) {
						//$( '.wpbooklist-edit-book-indiv-div-class' ).css({ 'opacity': '0.2' });
						$( '.wpbooklist-edit-book-title, .wpbooklist-edit-book-cover-img, .wpbooklist-edit-book-icon, .wpbooklist-edit-book-author, .wpbooklist-edit-actions-div' ).css({ 'pointer-events': 'none' });
						$( this ).css({ 'opacity': '1', 'pointer-events': 'none' });

						book = $( this ).attr( 'id' );
						origNode = $( this );
						$( this ).attr( 'id', 'book-in-movement' );
						console.log( book);
						var clone = $( this ).clone();
						clone.attr( 'id', 'clone' );
						$( this ).parent().append( clone );
						$( '#book-in-movement img, #book-in-movement p, #book-in-movement .wpbooklist-edit-actions-div' ).css({ 'opacity': '0' });
						$( '#book-in-movement .wpbooklist-edit-book-indiv-div-class' ).css({ 'border-color': 'black', 'border': '1px dashed black' });
					}
				}

				function wpbooklistmousemove( e ) {

					if ( e.pageY < oldx) {
						direction = "up"
					} else if ( e.pageY > oldx) {
						direction = "down"
					}
					oldx = e.pageY;

					$( '#clone .wpbooklist-edit-book-indiv-div-class' ).css({
						border: 'none'
					});

					$( '#clone' ).css({
						left:  e.pageX-250,
						top:   e.pageY-250,
						position: 'absolute',
						float: 'left',
						backgroundColor: 'white',
						zIndex: '999',
						pointerEvents: 'none',
						border: '1px solid #e5e5e5'
					});
				}

				function wpbooklistmouseenter( e ) {
					if ( window.isScrolling) return;
					if ( $( this ).attr( 'id' ) != 'book-in-movement' ) {
						if (mousedown ) {
							if ( direction == 'up' ) {
								console.log(origNode.prev().attr( 'class' ))
								if (origNode.prev().attr( 'class' ) == 'wpbooklist-search-indiv-container wpbooklist-search-indiv-container-reorder' ) {
									origNode.prev().insertAfter(origNode );
									// Scrolls back to the top of the title 
									var scrollTop = ( $( '#book-in-movement' ).offset().top + $( '#book-in-movement' ).height() / 2) - document.documentElement.clientHeight/2;
									if ( scrollTop != 0 ) {
										$( 'html, body' ).animate({
										scrollTop: scrollTop
										}, 500 );
										scrollTop = 0;
									}
									return;
								}
								return;
							}

							if ( direction == 'down' ) {
								if (origNode.next().attr( 'class' ) == 'wpbooklist-search-indiv-container wpbooklist-search-indiv-container-reorder' ) {
									origNode.next().insertBefore(origNode );
									var scrollTop = ( $( '#book-in-movement' ).offset().top + $( '#book-in-movement' ).height() / 2) - document.documentElement.clientHeight/2
									if ( scrollTop != 0 ) {
										$( 'html, body' ).animate({
										scrollTop: scrollTop
										}, 500 );
										scrollTop = 0;
									}
									return;
								}
								return;
							}
							
						}
					}
				}

				// Registering the various listeners for 'Reorder' mode.
				$( document ).on( 'mousedown', '.wpbooklist-search-indiv-container-reorder', wpbooklistmousedown )
				$( document ).on( 'mouseenter', '.wpbooklist-search-indiv-container-reorder', wpbooklistmouseenter);

		}

		// For the exit survey triggered when user deactivates WPBookList
		function wpbooklistExitSurveyResults() {
			$( document ).on( 'click', '#wpbooklist-modal-submit, #wpbooklist-modal-close', function( event ) {



					var id = '';
					if ( $( this ).attr( 'id' ) == 'wpbooklist-modal-close' ) {
						var id = 'wpbooklist-modal-close';
					} else {
						var id = 'wpbooklist-modal-submit';
					}

					var reasonEmail = $( '#wpbooklist-modal-email' ).val()
					console.log( reasonEmail )
					if ( reasonEmail != '' ) {
						var reasonEmailInput = document.getElementById( 'wpbooklist-modal-email' );
						var filter = /^([a-zA-Z0-9_\.\-]) +\@( ([a-zA-Z0-9\-]) +\.) +([a-zA-Z0-9]{2,4}) +$/;
						if (!filter.test( reasonEmailInput.value )) {
						alert( 'Whoops! Looks like that might not be a valid E-mail address!' );
						reasonEmailInput.focus;
						return false;
						}
					}	

					var reason1 = $( '#wpbooklist-modal-reason1' ).prop( 'checked' )
					var reason2 = $( '#wpbooklist-modal-reason2' ).prop( 'checked' )
					var reason3 = $( '#wpbooklist-modal-reason3' ).prop( 'checked' )
					var reason4 = $( '#wpbooklist-modal-reason4' ).prop( 'checked' )
					var reason5 = $( '#wpbooklist-modal-reason5' ).prop( 'checked' )
					var reason6 = $( '#wpbooklist-modal-reason6' ).prop( 'checked' )
					var reason7 = $( '#wpbooklist-modal-reason7' ).prop( 'checked' )
					var reason8 = $( '#wpbooklist-modal-reason8' ).prop( 'checked' )
					var reason9 = $( '#wpbooklist-modal-reason9' ).prop( 'checked' )
					var reasonOther = $( '#wpbooklist-modal-textarea' ).val()
					var reasonEmail = $( '#wpbooklist-modal-email' ).val()
					var featureSuggestion = $( '#wpbooklist-modal-textarea-suggest-feature' ).val()


					var data = {
						'action': 'wpbooklist_exit_results_action',
						'security': wpbooklistPhpVariables.adminnonce32,
						'reason1': reason1,
						'reason2': reason2,
						'reason3': reason3,
						'reason4': reason4,
						'reason5': reason5,
						'reason6': reason6,
						'reason7': reason7,
						'reason8': reason8,
						'reason9': reason9,
						'reasonOther': reasonOther,
						'reasonEmail': reasonEmail,
						'featureSuggestion': featureSuggestion,
						'id': id
					};
					console.log( data );

					var request = $.ajax({
						url: ajaxurl,
						type: 'POST',
						data: data,
						timeout: 0,
						success: function( response ) {

						document.location.reload( true );



						console.log( response );
						},
						error: function( jqXHR, textStatus, errorThrown ) {
							console.log( errorThrown );
							console.log( textStatus );
							console.log( jqXHR );
						}
					});

					event.preventDefault ? event.preventDefault() : event.returnValue = false;
				});
		}

		// Handles the popup that appears when the user deactivates WPBookList.
		function wpbooklistExitSurvey() {
	

		  var modalHtml = '<!-- The Modal --><div id="myModal" class="modal"><!-- Modal content --><div class="modal-content"><span class="close">&times;</span><img id="jre-domain-all-zips-loc" width="40" src="' + wpbooklistPhpVariables.ROOT_IMG_URL + 'icon-256x256.png" /><p id="wpbooklist-modal-title">' + wpbooklistPhpVariables.trans103 + '</p><p id="wpbooklist-modal-desc"><span style="font-weight: bold;font-style: italic;">' + wpbooklistPhpVariables.trans104 + '</span>, ' + wpbooklistPhpVariables.trans105 + ' </p><div id="wpbooklist-modal-reason-div"><div><input type="checkbox" id="wpbooklist-modal-reason1" /><label>' + wpbooklistPhpVariables.trans106 + '</label></div><div><input type="checkbox" id="wpbooklist-modal-reason2" /><label>' + wpbooklistPhpVariables.trans107 + '</label>  (<a href="https://wpbooklist.com/index.php/stylepaks-2/">StylePaks</a> - <a href="https://wpbooklist.com/index.php/templates-2/">Template Paks</a> - <a href="https://wpbooklist.com/index.php/downloads/stylizer-extension/">Stylizer Extension</a>)</div><div><input type="checkbox" id="wpbooklist-modal-reason3" /><label>' + wpbooklistPhpVariables.trans108 + '</label><div id="wpbooklist-suggested-feature-div"><label></label><textarea id="wpbooklist-modal-textarea-suggest-feature" placeholder="' + wpbooklistPhpVariables.trans109 + '"></textarea><label>' + wpbooklistPhpVariables.trans110 + ' <a href="https://wpbooklist.com/index.php/extensions/">' + wpbooklistPhpVariables.trans111 + '</a> - ' + wpbooklistPhpVariables.trans112 + '</label></div></div><div><input type="checkbox" id="wpbooklist-modal-reason4" /><label>' + wpbooklistPhpVariables.trans113 + '</label></div><div><input type="checkbox" id="wpbooklist-modal-reason5" /><label>' + wpbooklistPhpVariables.trans114 + '</label></div><div><input type="checkbox" id="wpbooklist-modal-reason6" /><label>' + wpbooklistPhpVariables.trans115 + ' <a href="https://wpbooklist.com/index.php/extensions/" target="_blank">' + wpbooklistPhpVariables.trans116 + '</a> ' + wpbooklistPhpVariables.trans117 + '</label></div><div><input type="checkbox" id="wpbooklist-modal-reason7" /><label>' + wpbooklistPhpVariables.trans118 + '</label></div><div><input type="checkbox" id="wpbooklist-modal-reason8" /><label>' + wpbooklistPhpVariables.trans119 + '</label></div><div><input type="checkbox" id="wpbooklist-modal-reason9" /><label>' + wpbooklistPhpVariables.trans120 + '</label></div><textarea id="wpbooklist-modal-textarea" placeholder="' + wpbooklistPhpVariables.trans121 + '"></textarea></div><div id="wpbooklist-modal-email-div"><label><span style="font-weight: bold;margin-bottom: -9px;display: block;">' + wpbooklistPhpVariables.trans122 + '</span></br>' + wpbooklistPhpVariables.trans123 + '</label><input id="wpbooklist-modal-email" style="margin-top: 7px;width:200px;" type="text" placeholder="' + wpbooklistPhpVariables.trans124 + '" /></div><div id="wpbooklist-modal-submit">' + wpbooklistPhpVariables.trans125 + '</div><div id="wpbooklist-modal-close">' + wpbooklistPhpVariables.trans126 + '</div></div></div>';

		  $( 'body' ).append(modalHtml );
		  $( '#myModal' ).css({ 'display': 'none' });

		  $( document ).on( 'click', '.deactivate', function( event ) {
			if ( $( this ).find( 'a' ).attr( 'href' ).indexOf( 'wpbooklist.php' ) != -1 ) {

			// Get and open the modal
			var modal = document.getElementById( 'myModal' );
			modal.style.display = "block";

			// Get the button that opens the modal
			var btn = document.getElementById( 'myBtn' );

			// Get the <span> element that closes the modal
			var span = document.getElementsByClassName( 'close' )[0];

			// When the user clicks on <span> (x), close the modal
			span.onclick = function() {
				//modal.style.display = "none";
			}

			// When the user clicks anywhere outside of the modal, close it
			window.onclick = function( event ) {
				if ( event.target == modal ) {
					//modal.style.display = "none";
				}
			}

			event.preventDefault ? event.preventDefault() : event.returnValue = false;

			}
		  });

		  $( document ).on( 'click', '#wpbooklist-modal-reason3', function( event ) {

			if ( $( this ).prop( 'checked' ) ) {
			$( '#wpbooklist-suggested-feature-div' ).animate({ 'height': '110px', 'top': '5px' });
			} else {
			$( '#wpbooklist-suggested-feature-div' ).animate({ 'height': '0px', 'top': '0px' });
			}
		  });
		  

		}






	// For retrieving the WPBookList StoryTime Stories from the server when the 'Select a Category' drop-down changes.
	function wpbooklistStorytimeSelectCategory() {
		$( document ).on( 'change', '#wpbooklist-storytime-category-select', function( event ) {

					var category = $( this ).val();
					$( '#wpbooklist-storytime-reader-selection-div-1-inner-1' ).animate({ 'opacity':0});

					var data = {
						'action': 'wpbooklist_storytime_select_category_action',
						'security': wpbooklistPhpVariables.adminnonce33,
						'category': category
					};
					console.log( data );

					var request = $.ajax({
						url: ajaxurl,
						type: 'POST',
						data: data,
						timeout: 0,
						success: function( response ) {
						console.log( response );


						$( '#wpbooklist-storytime-reader-selection-div-1-inner-1' ).html( response ).animate({ 'opacity':1});
						},
						error: function( jqXHR, textStatus, errorThrown ) {
							console.log( errorThrown );
							console.log( textStatus );
							console.log( jqXHR );
						}
					});

					event.preventDefault ? event.preventDefault() : event.returnValue = false;
				});
	}





	// For retreiving a WPBookList StoryTime Story from the server, once the user has selected one in the reader.
	function wpbooklistStorytimeGetStory() {
		$( document ).on( 'click', '.wpbooklist-storytime-listed-story', function( event ) {

					var title = $( this ).text();
					$( '#wpbooklist-storytime-reader-titlebar-div-2 h2' ).animate({
						opacity: 0
					}, {
						duration: 500,
						complete: function() {
							$( '#wpbooklist-storytime-reader-titlebar-div-2 h2' ).text( title )
							$( '#wpbooklist-storytime-reader-titlebar-div-2 h2' ).animate({ 'opacity':1});
						}
					});

					$( '#wpbooklist-storytime-reader-selection-div-1-inner-1' ).animate({
						height: 0,
						opacity: 0
					}, {
						duration: 500,
						complete: function() {
							$( '#wpbooklist-storytime-reader-selection-div-1-inner-2' ).animate({
								height: 48,
								opacity: 1
							}, {
								duration: 500,
								complete: function() {
									$( '#wpbooklist-storytime-reader-pagination-div' ).animate({
										height: 45,
										opacity: 1
									}, {
										duration: 500,
										complete: function() {
											//$( '#wpbooklist-storytime-reader-pagination-div' )
										} 
									}); 	
								} 
							});
						} 
					});


					var dataId = $( this ).attr( 'data-id' )

					var data = {
						'action': 'wpbooklist_storytime_get_story_action',
						'security': wpbooklistPhpVariables.adminnonce34,
						'dataId': dataId
					};
					console.log( data );

					var request = $.ajax({
						url: ajaxurl,
						type: 'POST',
						data: data,
						timeout: 0,
						success: function( response ) {

						response = JSON.parse( response );

						$( '#wpbooklist-storytime-reader-provider-div-1 img' ).animate({
								opacity: 0
							}, {
								duration: 500,
								complete: function() {
								$( this ).attr( 'src', response.providerimg)
								setTimeout( function() { $( '#wpbooklist-storytime-reader-provider-div-1 img' ).animate({ 'opacity':1}) }, 2000 );
								}
							});

						$( '#wpbooklist-storytime-reader-provider-p-1' ).animate({
								opacity: 0
							}, {
								duration: 500,
								complete: function() {
								$( this ).text( response.providername )
								setTimeout( function() { $( '#wpbooklist-storytime-reader-provider-p-1' ).animate({ 'opacity':1}) }, 2000 );
								}
							});

							$( '#wpbooklist-storytime-reader-provider-p-2' ).animate({
								opacity: 0
							}, {
								duration: 500,
								complete: function() {
								$( this ).html( response.providerbio)
								setTimeout( function() { $( '#wpbooklist-storytime-reader-provider-p-2' ).animate({ 'opacity':1}) }, 2000 );
								}
							});

						var content = $( '#wpbooklist-storytime-reader-content-div' ).html( response.content );
						var contentLocation = content.attr( 'data-location' );
						var contentHeight = content.height();

						if ( contentLocation == 'backend' ) {
							content.css({ 'height': '337px', 'overflow': 'auto' });
							var totalPages = Math.trunc(Math.ceil( contentHeight/337));
						} else {
							content.css({ 'height': '370px', 'overflow': 'auto' });
							var totalPages = Math.trunc(Math.ceil( contentHeight/370 ));
						}

						setTimeout( function() { $( '#wpbooklist-storytime-reader-content-div' ).animate({ 'opacity':1}) }, 2000 );

						if ( contentLocation == 'backend' ) {
							// Add in the HTML for deleting the selected Story 
							$( '#wpbooklist-storytime-reader-provider-div-delete' ).html( '<p id="wpbooklist-storytime-reader-provider-div-delete-p" data-id="' +dataId+ '">' +wpbooklistPhpVariables.trans127+ '</p>' );
							setTimeout( function() {

								$( '#wpbooklist-storytime-reader-provider-div-delete' ).animate({
										opacity: 1
									}, {
										duration: 500,
										complete: function() {
											$( '#wpbooklist-storytime-reader-provider-div-delete-p' ).css({ 'pointer-events': 'all' });
										}
									}); 
							}, 2500 );
						}


						$( '#wpbooklist-storytime-reader-pagination-div-2-span-3' ).text( totalPages )

						console.log( contentHeight )
						console.log( totalPages )

						console.log( response );
						},
						error: function( jqXHR, textStatus, errorThrown ) {
							console.log( errorThrown );
							console.log( textStatus );
							console.log( jqXHR );
						}
					});

					event.preventDefault ? event.preventDefault() : event.returnValue = false;
				});
	}





	// For expanding the 'Browse Stories' section again once a Story has already been selected.
	function wpbooklistStorytimeExpandBrowse() {
		$( document ).on( 'click', '#wpbooklist-storytime-reader-selection-div-1-inner-2', function( event ) {

					var contentLocation = $( this ).attr( 'data-location' );

					if ( contentLocation == 'backend' ) {
						$( '#wpbooklist-storytime-reader-provider-div-delete' ).animate({
							opacity: 0
						}, {
							duration: 500,
							complete: function() {
								$( '#wpbooklist-storytime-reader-provider-div-delete-p' ).css({ 'pointer-events': 'none' });
							}
							}); 
					}

					$( '#wpbooklist-storytime-reader-content-div' ).animate({
						opacity: 0
					}, {
						duration: 500,
						complete: function() {
							$( '#wpbooklist-storytime-reader-content-div' ).css({ 'height': '' });
						}
					});

					$( '#wpbooklist-storytime-reader-titlebar-div-2 h2' ).animate({
						opacity: 0
					}, {
						duration: 500,
						complete: function() {
							$( '#wpbooklist-storytime-reader-titlebar-div-2 h2' ).text( 'Select a Story...' )
							$( '#wpbooklist-storytime-reader-titlebar-div-2 h2' ).animate({ 'opacity':1});
						}
					});

					$( '#wpbooklist-storytime-reader-selection-div-1-inner-2' ).animate({
						height: 0,
						opacity: 0
					}, {
						duration: 500,
						complete: function() {
							$( '#wpbooklist-storytime-reader-pagination-div' ).animate({
								height: 0,
								opacity: 0
							}, {
								duration: 500,
								complete: function() {
									
								} 
							});
						} 
					});

					var data = {
						'action': 'wpbooklist_storytime_expand_browse_action',
						'security': wpbooklistPhpVariables.adminnonce35,
					};
					console.log( data );

					var request = $.ajax({
						url: ajaxurl,
						type: 'POST',
						data: data,
						timeout: 0,
						success: function( response ) {
						console.log( response );

						$( '#wpbooklist-storytime-reader-provider-div-1 img' ).animate({
								opacity: 0
							}, {
								duration: 500,
								complete: function() {
								$( this ).attr( 'src', wpbooklistPhpVariables.ROOT_IMG_URL + 'icon-256x256.png' )
								setTimeout( function() { $( '#wpbooklist-storytime-reader-provider-div-1 img' ).animate({ 'opacity':1}) }, 1000 );
								}
							});

						$( '#wpbooklist-storytime-reader-provider-p-1' ).animate({
								opacity: 0
							}, {
								duration: 500,
								complete: function() {
								$( this ).text( 'Discover new Authors and Publishers!' )
								setTimeout( function() { $( '#wpbooklist-storytime-reader-provider-p-1' ).animate({ 'opacity':1}) }, 1000 );
								}
							});

							$( '#wpbooklist-storytime-reader-provider-p-2' ).animate({
								opacity: 0
							}, {
								duration: 500,
								complete: function() {
								$( this ).text( wpbooklistPhpVariables.trans128 )
								setTimeout( function() { $( '#wpbooklist-storytime-reader-provider-p-2' ).animate({ 'opacity':1}) }, 1000 );
								}
							});



						$( '#wpbooklist-storytime-reader-selection-div-1-inner-1' ).html( response )
						$( '#wpbooklist-storytime-reader-selection-div-1-inner-1' ).animate({
								height: '466px',
							opacity: 1
							}, {
								duration: 500,
								complete: function() {
									//$( '#wpbooklist-storytime-reader-pagination-div' )
								} 
							}); 

						},
						error: function( jqXHR, textStatus, errorThrown ) {
							console.log( errorThrown );
							console.log( textStatus );
							console.log( jqXHR );
						}
					});

					event.preventDefault ? event.preventDefault() : event.returnValue = false;
				});
	}

	// For saving the StoryTime Settings
	function wpbooklistStorytimeSaveSettings() {
		$( document ).on( 'click', '#wpbooklist-storytime-settings-save', function( event ) {

					$( '#wpbooklist-spinner-storytime-settings' ).animate({ 'opacity':1});

					var input1 = $( '#wpbooklist-storytime-settings-input-1' ).prop( 'checked' )
					var input2 = $( '#wpbooklist-storytime-settings-input-2' ).prop( 'checked' )
					var input3 = $( '#wpbooklist-storytime-settings-input-3' ).prop( 'checked' )
					var input4 = $( '#wpbooklist-storytime-settings-input-4' ).prop( 'checked' )
					var input5 = $( '#wpbooklist-storytime-settings-input-5' ).prop( 'checked' )
					var input6 = $( '#wpbooklist-storytime-settings-input-6' ).val();

					var data = {
						'action': 'wpbooklist_storytime_save_settings_action',
						'security': wpbooklistPhpVariables.adminnonce36,
						'input1': input1,
						'input2': input2,
						'input3': input3,
						'input4': input4,
						'input5': input5,
						'input6': input6,
					};
					console.log( data );

					var request = $.ajax({
						url: ajaxurl,
						type: 'POST',
						data: data,
						timeout: 0,
						success: function( response ) {
						document.location.reload( true );
						console.log( response );
						},
						error: function( jqXHR, textStatus, errorThrown ) {
							console.log( errorThrown );
							console.log( textStatus );
							console.log( jqXHR );
						}
					});

					event.preventDefault ? event.preventDefault() : event.returnValue = false;
				});
	}

	// For deleting a Storytime Story.
	function wpbooklistDeleteStorytimeStory() {
		$( document ).on( 'click', '#wpbooklist-storytime-reader-provider-div-delete-p', function( event ) {

					var dataId = $( this ).attr( 'data-id' )

					var data = {
						'action': 'wpbooklist_delete_story_action',
						'security':  wpbooklistPhpVariables.adminnonce37,
						'dataId': dataId
					};
					console.log( data );

					var request = $.ajax({
						url: ajaxurl,
						type: 'POST',
						data: data,
						timeout: 0,
						success: function( response ) {
						console.log( response );
						document.location.reload( true );
						},
						error: function( jqXHR, textStatus, errorThrown ) {
							console.log( errorThrown );
							console.log( textStatus );
							console.log( jqXHR );
						}
					});

					event.preventDefault ? event.preventDefault() : event.returnValue = false;
				});
	}

		// For paging ahead in a Storytime Story.
		function wpbooklistStorytimePageBackForth() {
				var contentDiv = $( '#wpbooklist-storytime-reader-content-div' );
			var contentLocation = contentDiv.attr( 'data-location' );
			var path = "<?php echo SOUNDS_URL ?>navleftright.mp3"
			var snd = new Audio(path);

			if ( contentLocation == 'backend' ) {
			contentDiv.scroll( function() {
				$( '#wpbooklist-storytime-reader-pagination-div-2-span-1' ).text(Math.trunc( contentDiv.scrollTop()/337) + 1 )
			});
			} else {
			contentDiv.scroll( function() {
				$( '#wpbooklist-storytime-reader-pagination-div-2-span-1' ).text(Math.trunc( contentDiv.scrollTop()/370 ) + 1 )
			});
			}

			$( document ).on( 'click', '#wpbooklist-storytime-reader-pagination-div-3', function( event ) {

			var contentDiv = $( '#wpbooklist-storytime-reader-content-div' );
			var path = "<?php echo SOUNDS_URL ?>navleftright.mp3"
			var snd = new Audio(path);
			snd.play();

			$( this ).css({ 'pointer-events': 'none' });

			var currentPage = $( '#wpbooklist-storytime-reader-pagination-div-2-span-1' );
			var currentPageNum = parseInt( $( '#wpbooklist-storytime-reader-pagination-div-2-span-1' ).text());
			var totalPages = parseInt( $( '#wpbooklist-storytime-reader-pagination-div-2-span-3' ).text());

			if ( contentLocation == 'backend' ) {
				var scrollGoal =  ( currentPageNum)*337
			} else {
				var scrollGoal =  ( currentPageNum)*370
			}

			contentDiv.animate({
					scrollTop: scrollGoal+ 'px'
				}, {
					duration: 1000,
					complete: function() {
					$( '#wpbooklist-storytime-reader-pagination-div-3' ).css({ 'pointer-events': 'all' });
					
					}
				});

			event.preventDefault ? event.preventDefault() : event.returnValue = false;
			});

			$( document ).on( 'click', '#wpbooklist-storytime-reader-pagination-div-1', function( event ) {

			var contentDiv = $( '#wpbooklist-storytime-reader-content-div' );
			var path = "<?php echo SOUNDS_URL ?>navleftright.mp3"
			var snd = new Audio(path);
			snd.play();

			$( this ).css({ 'pointer-events': 'none' });

			var currentPage = $( '#wpbooklist-storytime-reader-pagination-div-2-span-1' );
			var currentPageNum = parseInt( $( '#wpbooklist-storytime-reader-pagination-div-2-span-1' ).text());
			var totalPages = parseInt( $( '#wpbooklist-storytime-reader-pagination-div-2-span-3' ).text());


			if ( contentLocation == 'backend' ) {
				if ( contentDiv.scrollTop()%337 == 0 ) {
				var scrollGoal =  ( currentPageNum-2)*337
				} else {
				var scrollGoal =  ( currentPageNum-1 )*337
				}
			} else {
				if ( contentDiv.scrollTop()%370 == 0 ) {
				var scrollGoal =  ( currentPageNum-2)*370
				} else {
				var scrollGoal =  ( currentPageNum-1 )*370
				}
			}

			contentDiv.animate({
					scrollTop: scrollGoal+ 'px'
				}, {
					duration: 1000,
					complete: function() {
					$( '#wpbooklist-storytime-reader-pagination-div-1' ).css({ 'pointer-events': 'all' });
					
					}
				});

			event.preventDefault ? event.preventDefault() : event.returnValue = false;
			});

		}

		// For simply linking to Patreon
		function wpbooklistPatreonLink() {
			$( document ).on( 'click', '.wpbooklist-storytime-signup-div-left', function( event ) {

			window.location = "https://www.patreon.com/wpbooklist";

			event.preventDefault ? event.preventDefault() : event.returnValue = false;
			});

			$( document ).on( 'click', '#wpbooklist-storytime-for-demo-link', function( event ) {

			var scrollTop = $( '#wpbooklist-storytime-demo-top-cont' ).offset().top-50

			// Scrolls back to the top of the title 
			if ( scrollTop != 0 ) {
				$( 'html, body' ).animate({
				scrollTop: scrollTop
				}, 1500 );
				scrollTop = 0;
			}

			event.preventDefault ? event.preventDefault() : event.returnValue = false;
			});
		}

		// For validating that a user has become a Patreon Patron for StoryTime.
		function wpbooklistPatreonValidate() {

			$( document ).on( 'click', '.wpbooklist-storytime-signup-div-right', function( event ) {

			window.location = 'https://www.patreon.com/oauth2/authorize?response_type=code&client_id=fuL1ZQLyad6UPwhiIS1s3dlZcprkkF_mxcbdxWshJ-w_5znpRaap_NulMDa__2jH&redirect_uri=https://wpbooklist.com/index.php/storytime-patreon-redirect/&state=' + encodeURIComponent( window.location.href);

			event.preventDefault ? event.preventDefault() : event.returnValue = false;
			});

		}
});


// Makes a call to get every single book saved on website to seed the Book form for Autocomplete stuff.
function wpbooklistSeedBookFormAutocomplete() {

	var data = [];
	var request = '';

	if ( window.location.href.endsWith( '?page=WPBookList-Options-books' ) || window.location.href.endsWith( '?page=WPBookList-Options-books&tab=book' ) || window.location.href.endsWith( '?page=WPBookList-Options-books&tab=edit-books' ) ) {


		data = {
			'action': 'wpbooklist_seed_book_form_autocomplete_action',
			'security': wpbooklistPhpVariables.adminnonce41
		};

		request = $.ajax({
			url: ajaxurl,
			type: 'POST',
			data: data,
			timeout: 0,
			success: function( response ) {

				var authorArray = [];
				var titleArray = [];
				var author1 = '';
				var author2 = '';
				var author3 = '';
				var isbn10Array = [];
				var isbn13Array = [];
				var asinArray = [];
				var publisherArray = [];
				var illustratorArray = [];
				var callnumberArray = [];
				var genreArray = [];
				var similarbooksArray = [];
				response = JSON.parse( response );

				console.log( response );

				// Now build out individual arrays - Looping through all libraries first.
				for ( var i = response.length - 1; i >= 0; i-- ) {

					// Looping through each book in specific library
					for ( var r = response[i].length - 1; r >= 0; r-- ) {


						// Build Author Array.
						author1 = response[i][r].authorfirst + ' ' + response[i][r].authorlast;
						author2 = response[i][r].author2first + ' ' + response[i][r].author2last;
						author3 = response[i][r].author3first + ' ' + response[i][r].author3last;
						if ( 'null' !== author1 && null !== author1 && undefined !== author1 && 'undefined' !== author1 && 'undefined undefined' !== author1 && ' ' !== author1 ) {
							authorArray.push( author1 );
						}
						if ( 'null' !== author2 && null !== author2 && undefined !== author2 && 'undefined' !== author2 && 'undefined undefined' !== author2 && ' ' !== author2 ) {
							authorArray.push( author2 );
						}
						if ( 'null' !== author3 && null !== author3 && undefined !== author3 && 'undefined' !== author3 && 'undefined undefined' !== author3 && ' ' !== author3 ) {
							authorArray.push( author3 );
						}

						// Build Title Array
						if ( 'null' !== response[i][r].title && null !== response[i][r].title && undefined !== response[i][r].title && 'undefined' !== response[i][r].title && '' !== response[i][r].title ) {
							titleArray.push( response[i][r].title );
						}

						// Build ISBN10 array
						if ( 'null' !== response[i][r].isbn && null !== response[i][r].isbn && undefined !== response[i][r].isbn && 'undefined' !== response[i][r].isbn && '' !== response[i][r].isbn ) {
							isbn10Array.push( response[i][r].isbn );
						}

						// Build isbn13 array
						if ( 'null' !== response[i][r].isbn13 && null !== response[i][r].isbn13 && undefined !== response[i][r].isbn13 && 'undefined' !== response[i][r].isbn13 && '' !== response[i][r].isbn13 ) {
							isbn13Array.push( response[i][r].isbn13 );
						}

						// Build asin array
						if ( 'null' !== response[i][r].asin && null !== response[i][r].asin && undefined !== response[i][r].asin && 'undefined' !== response[i][r].asin && '' !== response[i][r].asin ) {
							asinArray.push( response[i][r].asin );
						}

						// Build publisher array
						if ( 'null' !== response[i][r].publisher && null !== response[i][r].publisher && undefined !== response[i][r].publisher && 'undefined' !== response[i][r].publisher && '' !== response[i][r].publisher ) {
							publisherArray.push( response[i][r].publisher );
						}

						// Build illustrator array
						if ( 'null' !== response[i][r].illustrator && null !== response[i][r].illustrator && undefined !== response[i][r].illustrator && 'undefined' !== response[i][r].illustrator && '' !== response[i][r].illustrator ) {
							illustratorArray.push( response[i][r].illustrator );
						}

						// Build callnumber array
						if ( 'null' !== response[i][r].callnumber && null !== response[i][r].callnumber && undefined !== response[i][r].callnumber && 'undefined' !== response[i][r].callnumber && '' !== response[i][r].callnumber ) {
							callnumberArray.push( response[i][r].callnumber );
						}

						// Build genre array with Category data
						if ( 'null' !== response[i][r].category && null !== response[i][r].category && undefined !== response[i][r].category && 'undefined' !== response[i][r].category && '' !== response[i][r].category ) {
							genreArray.push( response[i][r].category );
						}

						// Build genre array with Subject data
						if ( 'null' !== response[i][r].subject && null !== response[i][r].subject && undefined !== response[i][r].subject && 'undefined' !== response[i][r].subject && '' !== response[i][r].subject ) {
							genreArray.push( response[i][r].subject );
						}

						// Build genre array with Sub-Genre Data
						if ( 'null' !== response[i][r].subgenre && null !== response[i][r].subgenre && undefined !== response[i][r].subgenre && 'undefined' !== response[i][r].subgenre && '' !== response[i][r].subgenre ) {
							genreArray.push( response[i][r].subgenre );
						}

						// Build Similar Books array with Title and ISBN Data.
						if ( 'null' !== response[i][r].title && null !== response[i][r].title && undefined !== response[i][r].title && 'undefined' !== response[i][r].title && '' !== response[i][r].title ) {
							similarbooksArray.push( response[i][r].title );
						}


					}
				}

				// Helper function to Unique-ify the arrays.
				Array.prototype.unique = function() {
					return this.filter( function ( value, index, self ) {
						return self.indexOf( value ) === index;
					});
				};

				// Now Unique-ify all arrays.
				authorArray = authorArray.unique();
				titleArray = titleArray.unique();
				isbn10Array = isbn10Array.unique();
				isbn13Array = isbn13Array.unique();
				asinArray = asinArray.unique();
				publisherArray = publisherArray.unique();
				illustratorArray = illustratorArray.unique();
				callnumberArray = callnumberArray.unique();
				genreArray = genreArray.unique();

				console.log( titleArray );

				// Now seed the author1 field.
				$( document ).on( 'focus', 'input[name="book-author1"]', function( e ) {

					if ( ! $( this ).data( 'autocomplete' ) ) {
						$( this ).autocomplete({source: authorArray }, {
							minChars: 1,
							width: 402,
							matchContains: 'word',
							autoFill: true,
							select: function( event, ui ) {

							}
						});
					}
				});


				// Now seed the author2 field.
				$( document ).on( 'focus', 'input[name="book-author2"]', function( e ) {

					if ( ! $( this ).data( 'autocomplete' ) ) {
						$( this ).autocomplete({source: authorArray }, {
							minChars: 1,
							width: 402,
							matchContains: 'word',
							autoFill: true,
							select: function( event, ui ) {

							}
						});
					}
				});

				// Now seed the author3 field.
				$( document ).on( 'focus', 'input[name="book-author3"]', function( e ) {

					if ( ! $( this ).data( 'autocomplete' ) ) {
						$( this ).autocomplete({source: authorArray }, {
							minChars: 1,
							width: 402,
							matchContains: 'word',
							autoFill: true,
							select: function( event, ui ) {

							}
						});
					}
				});

				// Now seed the title field.
				$( document ).on( 'focus', 'input[name="book-booktitle"]', function( e ) {

					if ( ! $( this ).data( 'autocomplete' ) ) {
						$( this ).autocomplete({source: titleArray }, {
							minChars: 1,
							width: 402,
							matchContains: 'word',
							autoFill: true,
							select: function( event, ui ) {

							}
						});
					}
				});

				// Now seed the original title field.
				$( document ).on( 'focus', 'input[name="book-originaltitle"]', function( e ) {

					if ( ! $( this ).data( 'autocomplete' ) ) {
						$( this ).autocomplete({source: titleArray }, {
							minChars: 1,
							width: 402,
							matchContains: 'word',
							autoFill: true,
							select: function( event, ui ) {

							}
						});
					}
				});

				// Now seed the isbn10 field.
				$( document ).on( 'focus', 'input[name="book-isbn10"]', function( e ) {

					if ( ! $( this ).data( 'autocomplete' ) ) {
						$( this ).autocomplete({source: isbn10Array }, {
							minChars: 1,
							width: 402,
							matchContains: 'word',
							autoFill: true,
							select: function( event, ui ) {

							}
						});
					}
				});


				// Now seed the isbn13 field.
				$( document ).on( 'focus', 'input[name="book-isbn13"]', function( e ) {

					if ( ! $( this ).data( 'autocomplete' ) ) {
						$( this ).autocomplete({source: isbn13Array }, {
							minChars: 1,
							width: 402,
							matchContains: 'word',
							autoFill: true,
							select: function( event, ui ) {

							}
						});
					}
				});

				// Now seed the asin field.
				$( document ).on( 'focus', 'input[name="book-asin"]', function( e ) {

					if ( ! $( this ).data( 'autocomplete' ) ) {
						$( this ).autocomplete({source: asinArray }, {
							minChars: 1,
							width: 402,
							matchContains: 'word',
							autoFill: true,
							select: function( event, ui ) {

							}
						});
					}
				});

				// Now seed the publisher field.
				$( document ).on( 'focus', 'input[name="book-publisher"]', function( e ) {

					if ( ! $( this ).data( 'autocomplete' ) ) {
						$( this ).autocomplete({source: publisherArray }, {
							minChars: 1,
							width: 402,
							matchContains: 'word',
							autoFill: true,
							select: function( event, ui ) {

							}
						});
					}
				});

				// Now seed the illustrator field.
				$( document ).on( 'focus', 'input[name="book-illustrator"]', function( e ) {

					if ( ! $( this ).data( 'autocomplete' ) ) {
						$( this ).autocomplete({source: illustratorArray }, {
							minChars: 1,
							width: 402,
							matchContains: 'word',
							autoFill: true,
							select: function( event, ui ) {

							}
						});
					}
				});

				// Now seed the callnumber field.
				$( document ).on( 'focus', 'input[name="book-callnumber"]', function( e ) {

					if ( ! $( this ).data( 'autocomplete' ) ) {
						$( this ).autocomplete({source: callnumberArray }, {
							minChars: 1,
							width: 402,
							matchContains: 'word',
							autoFill: true,
							select: function( event, ui ) {

							}
						});
					}
				});

				// Now seed the genre field.
				$( document ).on( 'focus', 'input[name="book-genre"]', function( e ) {

					if ( ! $( this ).data( 'autocomplete' ) ) {
						$( this ).autocomplete({source: genreArray }, {
							minChars: 1,
							width: 402,
							matchContains: 'word',
							autoFill: true,
							select: function( event, ui ) {

							}
						});
					}
				});

				// Now seed the subgenre field.
				$( document ).on( 'focus', 'input[name="book-subgenre"]', function( e ) {

					if ( ! $( this ).data( 'autocomplete' ) ) {
						$( this ).autocomplete({source: genreArray }, {
							minChars: 1,
							width: 402,
							matchContains: 'word',
							autoFill: true,
							select: function( event, ui ) {

							}
						});
					}
				});
			},
			error: function( jqXHR, textStatus, errorThrown ) {
				console.log( errorThrown );
				console.log( textStatus );
				console.log( jqXHR );
			}
		});
	}
}

// Function to display the admin pointer message when entering the Question Mark image with mouse...
function wpbooklistJreAdminPointersJavascript() {

	$( 'body' ).on( 'mouseenter', '.wpbooklist-icon-image-question', function() {

		var label = $( this ).attr( 'data-label' );
		var pointer;

		// Switch for which admin message to display
		switch ( label ) {
		case 'book-form-isbn10':
			pointer = $( this ).pointer({
				content: '<h3>' + wpbooklistPhpVariables.trans135 + '</h3><p class="wpbooklist-admin-pointer">' + wpbooklistPhpVariables.trans173 + '.</p>',
				position: {
					edge: 'right',
					align: 'right'
				}
			});
			break;
		case 'book-form-isbn13':
			pointer = $( this ).pointer({
				content: '<h3>' + wpbooklistPhpVariables.trans136 + '</h3><p class="wpbooklist-admin-pointer">' + wpbooklistPhpVariables.trans174 + '.</p>',
				position: {
					edge: 'right',
					align: 'right'
				}
			});
			break;
		case 'book-form-asin':
			pointer = $( this ).pointer({
				content: '<h3>' + wpbooklistPhpVariables.trans137 + '</h3><p class="wpbooklist-admin-pointer">' + wpbooklistPhpVariables.trans175 + '.</p>',
				position: {
					edge: 'right',
					align: 'right'
				}
			});
			break;
		case 'book-form-title':
			pointer = $( this ).pointer({
				content: '<h3>' + wpbooklistPhpVariables.trans138 + '</h3><p class="wpbooklist-admin-pointer">' + wpbooklistPhpVariables.trans176 + '.</p>',
				position: {
					edge: 'right',
					align: 'right'
				}
			});
			break;
		case 'book-form-originaltitle':
			pointer = $( this ).pointer({
				content: '<h3>' + wpbooklistPhpVariables.trans139 + '</h3><p class="wpbooklist-admin-pointer">' + wpbooklistPhpVariables.trans177 + '. ' + wpbooklistPhpVariables.trans180 + '.</p>',
				position: {
					edge: 'right',
					align: 'right'
				}
			});
			break;
		case 'book-form-publisher':
			pointer = $( this ).pointer({
				content: '<h3>' + wpbooklistPhpVariables.trans141 + '</h3><p class="wpbooklist-admin-pointer">' + wpbooklistPhpVariables.trans178 + '. ' + wpbooklistPhpVariables.trans180 + '.</p>',
				position: {
					edge: 'right',
					align: 'right'
				}
			});
			break;
		case 'book-form-illustrator':
			pointer = $( this ).pointer({
				content: '<h3>' + wpbooklistPhpVariables.trans140 + '</h3><p class="wpbooklist-admin-pointer">' + wpbooklistPhpVariables.trans179 + '. ' + wpbooklistPhpVariables.trans180 + '.</p>',
				position: {
					edge: 'right',
					align: 'right'
				}
			});
			break;
		case 'book-form-pages':
			pointer = $( this ).pointer({
				content: '<h3>' + wpbooklistPhpVariables.trans142 + '</h3><p class="wpbooklist-admin-pointer">' + wpbooklistPhpVariables.trans181 + '. ' + wpbooklistPhpVariables.trans180 + '.</p>',
				position: {
					edge: 'right',
					align: 'right'
				}
			});
			break;
		case 'book-form-callnumber':
			pointer = $( this ).pointer({
				content: '<h3>' + wpbooklistPhpVariables.trans144 + '</h3><p class="wpbooklist-admin-pointer">' + wpbooklistPhpVariables.trans182 + '. ' + wpbooklistPhpVariables.trans180 + '.</p>',
				position: {
					edge: 'right',
					align: 'right'
				}
			});
			break;
		case 'book-form-author1':
			pointer = $( this ).pointer({
				content: '<h3>' + wpbooklistPhpVariables.trans14 + '</h3><p class="wpbooklist-admin-pointer">' + wpbooklistPhpVariables.trans183 + '. ' + wpbooklistPhpVariables.trans186 + '. ' + wpbooklistPhpVariables.trans180 + '.</p>',
				position: {
					edge: 'right',
					align: 'right'
				}
			});
			break;
		case 'book-form-author2':
			pointer = $( this ).pointer({
				content: '<h3>' + wpbooklistPhpVariables.trans187 + '</h3><p class="wpbooklist-admin-pointer">' + wpbooklistPhpVariables.trans184 + '. ' + wpbooklistPhpVariables.trans186 + '. ' + wpbooklistPhpVariables.trans180 + '.</p>',
				position: {
					edge: 'right',
					align: 'right'
				}
			});
			break;
		case 'book-form-author3':
			pointer = $( this ).pointer({
				content: '<h3>' + wpbooklistPhpVariables.trans188 + '</h3><p class="wpbooklist-admin-pointer">' + wpbooklistPhpVariables.trans185 + '. ' + wpbooklistPhpVariables.trans186 + '. ' + wpbooklistPhpVariables.trans180 + '.</p>',
				position: {
					edge: 'right',
					align: 'right'
				}
			});
			break;
		case 'book-form-language':
			pointer = $( this ).pointer({
				content: '<h3>' + wpbooklistPhpVariables.trans154 + '</h3><p class="wpbooklist-admin-pointer">' + wpbooklistPhpVariables.trans189 + '. ' + wpbooklistPhpVariables.trans180 + '.</p>',
				position: {
					edge: 'right',
					align: 'right'
				}
			});
			break;
		case 'book-form-edition':
			pointer = $( this ).pointer({
				content: '<h3>' + wpbooklistPhpVariables.trans155 + '</h3><p class="wpbooklist-admin-pointer">' + wpbooklistPhpVariables.trans190 + '. ' + wpbooklistPhpVariables.trans180 + '.</p>',
				position: {
					edge: 'right',
					align: 'right'
				}
			});
			break;
		case 'book-form-series':
			pointer = $( this ).pointer({
				content: '<h3>' + wpbooklistPhpVariables.trans156 + '</h3><p class="wpbooklist-admin-pointer">' + wpbooklistPhpVariables.trans191 + '. ' + wpbooklistPhpVariables.trans180 + '.</p>',
				position: {
					edge: 'right',
					align: 'right'
				}
			});
			break;
		case 'book-form-numberinseries':
			pointer = $( this ).pointer({
				content: '<h3>' + wpbooklistPhpVariables.trans157 + '</h3><p class="wpbooklist-admin-pointer">' + wpbooklistPhpVariables.trans192 + '. ' + wpbooklistPhpVariables.trans180 + '.</p>',
				position: {
					edge: 'right',
					align: 'right'
				}
			});
			break;
		case 'book-form-format':
			pointer = $( this ).pointer({
				content: '<h3>' + wpbooklistPhpVariables.trans158 + '</h3><p class="wpbooklist-admin-pointer">' + wpbooklistPhpVariables.trans193 + '. ' + wpbooklistPhpVariables.trans180 + '.</p>',
				position: {
					edge: 'right',
					align: 'right'
				}
			});
			break;
		case 'book-form-amazonlink':
			pointer = $( this ).pointer({
				content: '<h3>' + wpbooklistPhpVariables.trans159 + '</h3><p class="wpbooklist-admin-pointer">' + wpbooklistPhpVariables.trans194 + '. ' + wpbooklistPhpVariables.trans201 + '. ' + wpbooklistPhpVariables.trans180 + '.</p>',
				position: {
					edge: 'right',
					align: 'right'
				}
			});
			break;
		case 'book-form-barnesandnoblelink':
			pointer = $( this ).pointer({
				content: '<h3>' + wpbooklistPhpVariables.trans160 + '</h3><p class="wpbooklist-admin-pointer">' + wpbooklistPhpVariables.trans195 + '. ' + wpbooklistPhpVariables.trans201 + '. ' + wpbooklistPhpVariables.trans180 + '.</p>',
				position: {
					edge: 'right',
					align: 'right'
				}
			});
			break;
		case 'book-form-googlebookslink':
			pointer = $( this ).pointer({
				content: '<h3>' + wpbooklistPhpVariables.trans161 + '</h3><p class="wpbooklist-admin-pointer">' + wpbooklistPhpVariables.trans196 + '. ' + wpbooklistPhpVariables.trans201 + '. ' + wpbooklistPhpVariables.trans180 + '.</p>',
				position: {
					edge: 'left',
					align: 'left'
				}
			});
			break;
		case 'book-form-ibookslink':
			pointer = $( this ).pointer({
				content: '<h3>' + wpbooklistPhpVariables.trans162 + '</h3><p class="wpbooklist-admin-pointer">' + wpbooklistPhpVariables.trans197 + '. ' + wpbooklistPhpVariables.trans201 + '. ' + wpbooklistPhpVariables.trans180 + '.</p>',
				position: {
					edge: 'right',
					align: 'right'
				}
			});
			break;
		case 'book-form-goodreadslink':
			pointer = $( this ).pointer({
				content: '<h3>' + wpbooklistPhpVariables.trans163 + '</h3><p class="wpbooklist-admin-pointer">' + wpbooklistPhpVariables.trans198 + '. ' + wpbooklistPhpVariables.trans201 + '. ' + wpbooklistPhpVariables.trans180 + '.</p>',
				position: {
					edge: 'right',
					align: 'right'
				}
			});
			break;
		case 'book-form-booksamillionlink':
			pointer = $( this ).pointer({
				content: '<h3>' + wpbooklistPhpVariables.trans164 + '</h3><p class="wpbooklist-admin-pointer">' + wpbooklistPhpVariables.trans199 + '. ' + wpbooklistPhpVariables.trans201 + '. ' + wpbooklistPhpVariables.trans180 + '.</p>',
				position: {
					edge: 'left',
					align: 'left'
				}
			});
			break;
		case 'book-form-kobolink':
			pointer = $( this ).pointer({
				content: '<h3>' + wpbooklistPhpVariables.trans165 + '</h3><p class="wpbooklist-admin-pointer">' + wpbooklistPhpVariables.trans200 + '. ' + wpbooklistPhpVariables.trans201 + '. ' + wpbooklistPhpVariables.trans180 + '.</p>',
				position: {
					edge: 'right',
					align: 'right'
				}
			});
			break;
		case 'book-form-authorlink':
			pointer = $( this ).pointer({
				content: '<h3>' + wpbooklistPhpVariables.trans166 + '</h3><p class="wpbooklist-admin-pointer">' + wpbooklistPhpVariables.trans202 + '. ' + wpbooklistPhpVariables.trans201 + '. ' + wpbooklistPhpVariables.trans180 + '.</p>',
				position: {
					edge: 'right',
					align: 'right'
				}
			});
			break;
		case 'book-form-libraries':
			pointer = $( this ).pointer({
				content: '<h3>' + wpbooklistPhpVariables.trans203 + '</h3><p class="wpbooklist-admin-pointer">' + wpbooklistPhpVariables.trans202 + '. ' + wpbooklistPhpVariables.trans204 + '.</p>',
				position: {
					edge: 'right',
					align: 'right'
				}
			});
			break;

		default:
		}

		// Open the pointer on mouseenter
		pointer.pointer( 'open' );

		// Close the pointer on mouseleave
		$( 'body' ).on( 'mouseleave', '.wpbooklist-icon-image-question', function() {
			pointer.pointer( 'close' );
		});
	});


	$( 'body' ).on( 'mouseenter', '.wpbooklist-icon-image-question-with-link', function() {

		var label = $( this ).attr( 'data-label' );
		var pointer;

		// Switch for which admin message to display
		switch ( label ) {
		case 'book-form-libraries':
			pointer = $( this ).pointer({
				content: '<h3>' + wpbooklistPhpVariables.trans203 + '</h3><p class="wpbooklist-admin-pointer">' + wpbooklistPhpVariables.trans204 + wpbooklistPhpVariables.SETTINGS_PAGE_URL + wpbooklistPhpVariables.trans205 + '.</p>',
				position: {
					edge: 'right',
					align: 'right'
				}
			});
			break;
		case 'book-form-amazonyesno':
			pointer = $( this ).pointer({
				content: '<h3>' + wpbooklistPhpVariables.trans209 + '</h3><p class="wpbooklist-admin-pointer">' + wpbooklistPhpVariables.trans206 + wpbooklistPhpVariables.SETTINGS_PAGE_URL + wpbooklistPhpVariables.trans207 + '. ' + wpbooklistPhpVariables.trans208 + '.</p>',
				position: {
					edge: 'right',
					align: 'right'
				}
			});
			break;
		default:
		}

		// Open the pointer on mouseenter
		pointer.pointer( 'open' );

	});
}
